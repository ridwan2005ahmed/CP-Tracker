<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competitive Programming Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #10b981;
            --secondary-color: #059669;
            --accent-color: #f59e0b;
            --success-color: #22c55e;
            --warning-color: #f97316;
            --danger-color: #ef4444;
            --dark-color: #374151;
            --light-color: #f9fafb;
            --shadow-light: 0 4px 15px rgba(0,0,0,0.1);
            --shadow-heavy: 0 20px 40px rgba(0,0,0,0.15);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        .sidebar {
            background: rgba(55, 65, 81, 0.95);
            backdrop-filter: blur(20px);
            min-height: 100vh;
            box-shadow: var(--shadow-heavy);
            position: fixed;
            width: 280px;
            z-index: 1000;
            border-right: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h2 {
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            margin: 0;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-header .subtitle {
            color: rgba(255,255,255,0.7);
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8) !important;
            border-radius: var(--border-radius);
            margin: 8px 15px;
            padding: 15px 20px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            font-weight: 500;
        }

        .sidebar .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: var(--transition);
        }

        .sidebar .nav-link:hover::before {
            left: 100%;
        }

        .sidebar .nav-link i {
            margin-right: 12px;
            font-size: 1.1rem;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: #fff !important;
            transform: translateX(8px) scale(1.02);
            box-shadow: var(--shadow-light);
        }
        
        .main-content {
            margin-left: 280px;
            padding: 30px;
            min-height: 100vh;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .content-section {
            display: none;
            animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .content-section.active {
            display: block;
        }
        
        @keyframes slideInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.95);
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .card {
            border: none;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            transition: var(--transition);
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-heavy);
            border-color: rgba(255,255,255,0.3);
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 20px;
            font-weight: 600;
            position: relative;
        }

        .card-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table {
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
        }
        
        .table th {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 20px 15px;
            position: relative;
        }

        .table th::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-color), transparent, var(--accent-color));
        }

        .table td {
            padding: 15px;
            vertical-align: middle;
            border-color: rgba(0,0,0,0.05);
        }

        .table tbody tr {
            transition: var(--transition);
        }

        .table tbody tr:hover {
            background: rgba(102, 126, 234, 0.05);
            transform: scale(1.01);
        }
        
        th, td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .btn-add {
            margin-bottom: 15px;
        }
        
        .btn {
            border-radius: var(--border-radius);
            font-weight: 600;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 12px 24px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transition: var(--transition);
            transform: translate(-50%, -50%);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-light);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0d9488, var(--primary-color));
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #16a34a);
            border: none;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #15803d, var(--success-color));
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
            transform: translateY(-2px);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #ea580c);
            border: none;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #c2410c, var(--warning-color));
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.4);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            border: none;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #b91c1c, var(--danger-color));
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
            transform: translateY(-2px);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .stats-card {
            text-align: center;
            padding: 30px;
            border-radius: 20px;
            color: white;
            margin-bottom: 20px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .stats-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transform: scale(0);
            transition: var(--transition);
        }

        .stats-card:hover::before {
            transform: scale(1);
        }
        
        .stats-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: var(--shadow-heavy);
            animation: pulse 2s infinite;
        }
        
        .stats-card i {
            font-size: 3rem;
            margin-bottom: 15px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .stats-card.blue {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }
        
        .stats-card.green {
            background: linear-gradient(135deg, var(--success-color), #16a34a);
        }
        
        .stats-card.orange {
            background: linear-gradient(135deg, var(--warning-color), #ea580c);
        }
        
        .stats-card.purple {
            background: linear-gradient(135deg, var(--accent-color), #d97706);
        }
        
        .editable {
            cursor: pointer;
            transition: var(--transition);
        }
        
        .editable:hover {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(245, 158, 11, 0.1));
            cursor: pointer;
            border-radius: 8px;
            transform: scale(1.02);
            box-shadow: var(--shadow-light);
        }
        
        #auth-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #auth-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="20" cy="20" r="1" fill="white" opacity="0.1"/><circle cx="80" cy="80" r="1" fill="white" opacity="0.1"/><circle cx="40" cy="60" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
        }
        
        #auth-box {
            width: 400px;
            padding: 50px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: var(--shadow-heavy);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
        }

        #auth-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color), var(--success-color));
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10000;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            box-shadow: var(--shadow-light);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .custom-toast {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
        }

        /* Dashboard Stats Grid - Matching Image Style */
        .dashboard-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-stat-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(16, 185, 129, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .dashboard-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #22c55e);
        }

        .dashboard-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .stat-header {
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 15px;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #10b981;
            margin-bottom: 8px;
            line-height: 1;
        }

        .stat-label {
            font-size: 14px;
            color: #9ca3af;
            font-weight: 500;
        }

        /* Main Stats Grid */
        .main-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .main-stat-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(16, 185, 129, 0.1);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            overflow: hidden;
        }

        .main-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #22c55e);
        }

        .main-stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background: linear-gradient(135deg, #10b981, #22c55e);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .stat-icon i {
            font-size: 28px;
            color: white;
        }

        .stat-content {
            flex: 1;
        }

        .stat-title {
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #374151;
            margin-bottom: 10px;
            line-height: 1;
        }

        .stat-badge {
            display: inline-block;
            background: linear-gradient(135deg, #10b981, #22c55e);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .main-stats-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .dashboard-stat-card {
                padding: 20px;
            }
            
            .main-stat-card {
                padding: 25px;
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .stat-number {
                font-size: 2rem;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
        }

        /* Loading Spinner */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(102, 126, 234, 0.1);
            border-left: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }

            .sidebar {
                transform: translateX(-100%);
                transition: var(--transition);
                width: 250px;
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 80px 15px 20px;
            }

            .quick-stats {
                grid-template-columns: 1fr;
            }

            .dashboard-stat h3 {
                font-size: 2rem;
            }

            #auth-box {
                margin: 20px;
                padding: 30px;
                width: calc(100% - 40px);
            }

            .card {
                margin-bottom: 15px;
            }

            .stats-card {
                padding: 20px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .fab:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 12px 35px rgba(16, 185, 129, 0.4);
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
        }

        .fab:active {
            transform: scale(0.95);
        }
        
        #auth-box {
            width: 300px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .progress {
            height: 20px;
        }
        .task-card {
            transition: all 0.3s;
        }
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        .completed-task {
            opacity: 0.7;
            background-color: #f8f9fa;
        }
        .recent-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .recent-item:last-child {
            border-bottom: none;
        }
        .topic-to-improve {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .topic-to-improve:last-child {
            border-bottom: none;
        }
        .confidence-stars {
            color: #ffc107;
        }
        .border-purple {
            border-color: #6f42c1 !important;
        }
        .text-purple {
            color: #6f42c1 !important;
        }
        .heatmap-day {
            width: 12px;
            height: 12px;
            margin: 1px;
            border-radius: 2px;
            display: inline-block;
            background-color: #eee;
        }
        .heatmap-day.level-1 { background-color: #c6e48b; }
        .heatmap-day.level-2 { background-color: #7bc96f; }
        .heatmap-day.level-3 { background-color: #239a3b; }
        .heatmap-day.level-4 { background-color: #196127; }
        .insight-item {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .suggestion-item {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            background-color: #f8f9fa;
            border-left: 4px solid #28a745;
        }

        /* Logout button styling */
        .btn-outline-danger {
            border-color: var(--danger-color);
            color: var(--danger-color);
            transition: var(--transition);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-outline-danger:hover {
            background: linear-gradient(135deg, var(--danger-color), #e74c3c);
            border-color: var(--danger-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .btn-outline-danger:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        /* Alternative logout button styles */
        #logout-btn {
            position: relative;
            overflow: hidden;
        }

        #logout-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transition: var(--transition);
            transform: translate(-50%, -50%);
        }

        #logout-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-outline-warning {
            border-color: var(--warning-color);
            color: var(--warning-color);
            transition: var(--transition);
        }

        .btn-outline-warning:hover {
            background: var(--warning-color);
            border-color: var(--warning-color);
            color: #333;
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        /* User dropdown styling */
        .dropdown-menu {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
        }

        .dropdown-item {
            transition: var(--transition);
            border-radius: 8px;
            margin: 2px 8px;
        }

        .dropdown-item:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(247, 147, 251, 0.1));
            transform: translateX(4px);
        }
    </style>
</head>
<body>
    <!-- Login/Signup Form (shown first) -->
    <div id="auth-container">
        <div id="auth-box">
            <h3 class="text-center mb-4">CP Tracker Login</h3>
            <div class="form-group">
                <input type="email" id="email" class="form-control" placeholder="Email">
            </div>
            <div class="form-group">
                <input type="password" id="password" class="form-control" placeholder="Password">
            </div>
            <button id="login-btn" class="btn btn-primary w-100 mb-2">Login</button>
            <button id="signup-btn" class="btn btn-secondary w-100 mb-2">Sign Up</button>
            <button id="forgot-password-btn" class="btn btn-link w-100 text-decoration-none">
                <i class="bi bi-key"></i> Forgot Password?
            </button>
            <div id="auth-message" class="mt-3 text-center text-danger"></div>
        </div>
    </div>

    <!-- Main App (hidden until login) -->
    <div id="app-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>CP Tracker</h2>
                <div class="subtitle">Competitive Programming Dashboard</div>
            </div>
            
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle d-lg-none" onclick="toggleSidebar()">
                <i class="bi bi-list"></i>
            </button>
            
            <div class="p-4">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-section="dashboard">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="tasks">
                            <i class="bi bi-list-check"></i> Task Manager
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="contests">
                            <i class="bi bi-trophy"></i> Contest Log
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="daily">
                            <i class="bi bi-calendar-day"></i> Daily Log
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="mistakes">
                            <i class="bi bi-exclamation-triangle"></i> Mistake Log
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="topics">
                            <i class="bi bi-book"></i> Topic Practice
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="analytics">
                            <i class="bi bi-graph-up"></i> Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="profile">
                            <i class="bi bi-person-gear"></i> Profile & Settings
                        </a>
                    </li>
                </ul>
                
                <!-- Streak Counter -->
                <div class="streak-counter mt-4 mb-3">
                    <div style="padding-left: 40px;">
                        <div style="font-size: 0.9rem; opacity: 0.8;">Current Streak</div>
                        <div id="streak-days" style="font-size: 1.2rem;">0 days</div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="quick-actions mb-3">
                    <button class="btn btn-primary btn-sm w-100 mb-2" onclick="quickAddProblem()">
                        <i class="bi bi-plus-circle"></i> Quick Add Problem
                    </button>
                    <button class="btn btn-success btn-sm w-100" onclick="openAutoFetch()">
                        <i class="bi bi-cloud-download"></i> Sync Data
                    </button>
                </div>
                
                <div class="mt-4 pt-3" style="border-top: 1px solid rgba(255,255,255,0.1);">
                    <button class="btn btn-outline-danger w-100" id="logout-btn" onclick="confirmLogout()">
                        <i class="bi bi-box-arrow-right me-2"></i> Logout
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="mb-0">
                        <i class="bi bi-speedometer2 me-2"></i>
                        Dashboard
                    </h2>
                    <div class="d-flex gap-2 align-items-center">
                        <button class="btn btn-primary btn-sm" onclick="showQuickStats()">
                            <i class="bi bi-lightning"></i> Quick Stats
                        </button>
                        <button class="btn btn-success btn-sm" onclick="refreshDashboard()">
                            <i class="bi bi-arrow-clockwise"></i> Refresh
                        </button>
                        
                        <!-- User Profile Dropdown -->
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-person-circle me-1"></i>
                                <span id="user-email-header">User</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                <li>
                                    <a class="dropdown-item" href="#" data-section="profile">
                                        <i class="bi bi-person-gear me-2"></i>Profile & Settings
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item text-danger" href="#" onclick="confirmLogout()">
                                        <i class="bi bi-box-arrow-right me-2"></i>Logout
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Quick Stats Row - Matching the Dashboard Image Style -->
                <div class="dashboard-stats-grid mb-4">
                    <div class="dashboard-stat-card">
                        <div class="stat-header">TODAY'S PROGRESS</div>
                        <div class="stat-number" id="today-problems">0</div>
                        <div class="stat-label">problems solved</div>
                    </div>
                    <div class="dashboard-stat-card">
                        <div class="stat-header">THIS WEEK</div>
                        <div class="stat-number" id="week-problems">0</div>
                        <div class="stat-label">problems solved</div>
                    </div>
                    <div class="dashboard-stat-card">
                        <div class="stat-header">AVERAGE RATING</div>
                        <div class="stat-number" id="avg-rating">-</div>
                        <div class="stat-label">across platforms</div>
                    </div>
                    <div class="dashboard-stat-card">
                        <div class="stat-header">SUCCESS RATE</div>
                        <div class="stat-number" id="success-rate">-</div>
                        <div class="stat-label">in contests</div>
                    </div>
                </div>
                
                <!-- Enhanced Main Stats Cards -->
                <div class="main-stats-grid">
                    <div class="main-stat-card">
                        <div class="stat-icon">
                            <i class="bi bi-trophy"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">CONTESTS</div>
                            <div class="stat-value" id="total-contests">0</div>
                            <div class="stat-badge">CONTESTANT</div>
                        </div>
                    </div>
                    <div class="main-stat-card">
                        <div class="stat-icon">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">PROBLEMS SOLVED</div>
                            <div class="stat-value" id="total-solved">0</div>
                            <div class="stat-badge">PROBLEM SOLVER</div>
                        </div>
                    </div>
                    <div class="main-stat-card">
                        <div class="stat-icon">
                            <i class="bi bi-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">MISTAKES LOGGED</div>
                            <div class="stat-value" id="total-mistakes">0</div>
                            <div class="stat-badge">LEARNER</div>
                        </div>
                    </div>
                    <div class="main-stat-card">
                        <div class="stat-icon">
                            <i class="bi bi-book"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">TOPICS PRACTICED</div>
                            <div class="stat-value" id="total-topics">0</div>
                            <div class="stat-badge">SCHOLAR</div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                Active Tasks
                            </div>
                            <div class="card-body">
                                <div id="active-tasks">
                                    <!-- Active tasks will appear here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-header">
                                Recent Contests
                            </div>
                            <div class="card-body p-0">
                                <div id="recent-contests">
                                    <!-- Recent contests will appear here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card mt-4">
                            <div class="card-header">
                                Recent Mistakes
                            </div>
                            <div class="card-body p-0">
                                <div id="recent-mistakes">
                                    <!-- Recent mistakes will appear here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                Topics to Improve
                            </div>
                            <div class="card-body p-0">
                                <div id="topics-to-improve">
                                    <!-- Topics to improve will appear here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Task Manager Section -->
            <div id="tasks-section" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Task Manager</h2>
                    <button class="btn btn-primary" id="add-task-btn">
                        <i class="bi bi-plus"></i> Add New Task
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs">
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-task-tab="all">All Tasks</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" href="#" data-task-tab="active">Active</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-task-tab="completed">Completed</a>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Task Name</th>
                                        <th>Type</th>
                                        <th>Progress</th>
                                        <th>Priority</th>
                                        <th>Due Date</th>
                                        <th>Status</th>
                                        <th>Notes</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="task-table">
                                    <!-- Tasks will appear here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Contest Log Section -->
            <div id="contests-section" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Contest Log</h2>
                    <button class="btn btn-primary btn-add" data-bs-toggle="modal" data-bs-target="#addContestModal">
                        <i class="bi bi-plus"></i> Add Contest
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Platform</th>
                                        <th>Contest Name</th>
                                        <th>Solved</th>
                                        <th>Rating Δ</th>
                                        <th>Rank</th>
                                        <th>Upsolved?</th>
                                        <th>Notes</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="contest-table">
                                    <!-- Contests will appear here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Daily Log Section -->
            <div id="daily-section" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Daily Log</h2>
                    <button class="btn btn-primary btn-add" data-bs-toggle="modal" data-bs-target="#addDailyModal">
                        <i class="bi bi-plus"></i> Add Entry
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>CF Solved</th>
                                        <th>AC Solved</th>
                                        <th>CC Solved</th>
                                        <th>Hours</th>
                                        <th>Contest?</th>
                                        <th>Notes</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="daily-table">
                                    <!-- Daily logs will appear here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mistake Log Section -->
            <div id="mistakes-section" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Mistake Log</h2>
                    <button class="btn btn-primary btn-add" data-bs-toggle="modal" data-bs-target="#addMistakeModal">
                        <i class="bi bi-plus"></i> Add Mistake
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Platform</th>
                                        <th>Problem</th>
                                        <th>Mistake Type</th>
                                        <th>Reason</th>
                                        <th>Fix Strategy</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="mistake-table">
                                    <!-- Mistakes will appear here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Topic Practice Section -->
            <div id="topics-section" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Topic Practice</h2>
                    <button class="btn btn-primary btn-add" data-bs-toggle="modal" data-bs-target="#addTopicModal">
                        <i class="bi bi-plus"></i> Add Topic
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Topic</th>
                                        <th>Solved</th>
                                        <th>Confidence (1-5)</th>
                                        <th>Last Practiced</th>
                                        <th>Notes</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="topic-table">
                                    <!-- Topics will appear here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analytics-section" style="display: none;">
                <h2 class="mb-4">Analytics</h2>
                
                <!-- Daily Progress Analytics -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-calendar-day text-primary" style="font-size: 2rem;"></i>
                                <h5 class="card-title mt-2">Today</h5>
                                <h3 class="text-primary" id="today-progress">0</h3>
                                <small class="text-muted">Problems Solved</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-calendar3 text-success" style="font-size: 2rem;"></i>
                                <h5 class="card-title mt-2">Last 3 Days</h5>
                                <h3 class="text-success" id="three-days-progress">0</h3>
                                <small class="text-muted">Problems Solved</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-book text-warning" style="font-size: 2rem;"></i>
                                <h5 class="card-title mt-2">Topics (3 Days)</h5>
                                <h3 class="text-warning" id="topics-three-days">0</h3>
                                <small class="text-muted">Topics Practiced</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-calendar-week text-info" style="font-size: 2rem;"></i>
                                <h5 class="card-title mt-2">This Week</h5>
                                <h3 class="text-info" id="week-progress">0</h3>
                                <small class="text-muted">Problems Solved</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Daily Progress Chart -->
                <div class="card mb-4">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Daily Progress Tracking</h5>
                            <div class="btn-group btn-group-sm" role="group">
                                <button type="button" class="btn btn-outline-primary active" id="progress-7days">7 Days</button>
                                <button type="button" class="btn btn-outline-primary" id="progress-14days">14 Days</button>
                                <button type="button" class="btn btn-outline-primary" id="progress-30days">30 Days</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <canvas id="dailyProgressChart" height="300"></canvas>
                    </div>
                </div>

                <!-- Topic Learning Progress -->
                <div class="card mb-4">
                    <div class="card-header">
                        Topic Learning Timeline (Last 30 Days)
                    </div>
                    <div class="card-body">
                        <canvas id="topicTimelineChart" height="200"></canvas>
                    </div>
                </div>
                
                <!-- Advanced Analytics Section -->
                <div class="row mb-4">
                    <!-- Contest Performance Metrics -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Contest Performance Trends</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="contestRatingChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Problem Solving Velocity -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Problem Solving Velocity</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="solvingVelocityChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Metrics Cards -->
                <div class="row mb-4">
                    <div class="col-md-2">
                        <div class="card text-center border-primary">
                            <div class="card-body">
                                <i class="bi bi-lightning text-primary" style="font-size: 1.5rem;"></i>
                                <h6 class="text-primary mt-2 mb-1">Avg Rating Δ</h6>
                                <h5 class="text-primary" id="avg-rating-change">+0</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center border-success">
                            <div class="card-body">
                                <i class="bi bi-speedometer text-success" style="font-size: 1.5rem;"></i>
                                <h6 class="text-success mt-2 mb-1">Problems/Day</h6>
                                <h5 class="text-success" id="problems-per-day">0</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center border-warning">
                            <div class="card-body">
                                <i class="bi bi-target text-warning" style="font-size: 1.5rem;"></i>
                                <h6 class="text-warning mt-2 mb-1">Accuracy</h6>
                                <h5 class="text-warning" id="contest-accuracy">0%</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center border-info">
                            <div class="card-body">
                                <i class="bi bi-clock text-info" style="font-size: 1.5rem;"></i>
                                <h6 class="text-info mt-2 mb-1">Study Streak</h6>
                                <h5 class="text-info" id="study-streak">0</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center border-purple">
                            <div class="card-body">
                                <i class="bi bi-trophy text-purple" style="font-size: 1.5rem;"></i>
                                <h6 class="text-purple mt-2 mb-1">Best Rank</h6>
                                <h5 class="text-purple" id="best-rank">-</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center border-danger">
                            <div class="card-body">
                                <i class="bi bi-graph-up text-danger" style="font-size: 1.5rem;"></i>
                                <h6 class="text-danger mt-2 mb-1">Improvement</h6>
                                <h5 class="text-danger" id="improvement-score">0%</h5>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comprehensive Analysis -->
                <div class="row mb-4">
                    <!-- Platform Distribution -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Platform Distribution</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="platformChart" height="250"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Topic Mastery Radar -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Topic Mastery Level</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="topicMasteryChart" height="250"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mistake Analysis -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Common Mistakes</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="mistakeDistributionChart" height="250"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Heatmap and Time Analysis -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">Activity Heatmap</h6>
                                    <select class="form-select form-select-sm" style="width: auto;" id="heatmapPeriod">
                                        <option value="3months">Last 3 Months</option>
                                        <option value="6months">Last 6 Months</option>
                                        <option value="1year">Last Year</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="activityHeatmap" style="height: 200px; overflow-x: auto;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Study Time Analysis</h6>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-12 mb-3">
                                        <h4 class="text-primary" id="total-study-hours">0h</h4>
                                        <small class="text-muted">Total Study Time</small>
                                    </div>
                                    <div class="col-6 mb-2">
                                        <h6 class="text-success" id="avg-daily-hours">0h</h6>
                                        <small class="text-muted">Daily Average</small>
                                    </div>
                                    <div class="col-6 mb-2">
                                        <h6 class="text-warning" id="peak-study-day">-</h6>
                                        <small class="text-muted">Most Active Day</small>
                                    </div>
                                </div>
                                <canvas id="studyTimeChart" height="150"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI-Powered Insights -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-lightbulb text-warning"></i>
                            Smart Insights & Recommendations
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary">Performance Insights</h6>
                                <div id="performance-insights">
                                    <!-- Dynamic insights will appear here -->
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-success">Improvement Suggestions</h6>
                                <div id="improvement-suggestions">
                                    <!-- Dynamic suggestions will appear here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        Performance Overview
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <canvas id="solvedChart" height="300"></canvas>
                            </div>
                            <div class="col-md-6">
                                <canvas id="mistakesChart" height="300"></canvas>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-md-12">
                                <canvas id="topicsChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Profile & Settings Section -->
            <div id="profile-section" style="display: none;">
                <h2 class="mb-4">Profile & Settings</h2>
                
                <div class="row">
                    <!-- User Profile Card -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-person"></i> User Profile</h5>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-4">
                                    <i class="bi bi-person-circle" style="font-size: 4rem; color: #6c757d;"></i>
                                    <h5 class="mt-2" id="userEmail">Loading...</h5>
                                    <small class="text-muted">Account created: <span id="userCreated">Loading...</span></small>
                                </div>
                                
                                <div class="row text-center">
                                    <div class="col-4">
                                        <h6 class="text-primary" id="profileTotalProblems">0</h6>
                                        <small class="text-muted">Total Problems</small>
                                    </div>
                                    <div class="col-4">
                                        <h6 class="text-success" id="profileTotalContests">0</h6>
                                        <small class="text-muted">Total Contests</small>
                                    </div>
                                    <div class="col-4">
                                        <h6 class="text-warning" id="profileTotalTopics">0</h6>
                                        <small class="text-muted">Topics Learned</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Change Password Card -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-shield-lock"></i> Change Password</h5>
                            </div>
                            <div class="card-body">
                                <form id="changePasswordForm">
                                    <div class="form-group mb-3">
                                        <label for="currentPassword" class="form-label">Current Password</label>
                                        <input type="password" class="form-control" id="currentPassword" required>
                                    </div>
                                    <div class="form-group mb-3">
                                        <label for="newPassword" class="form-label">New Password</label>
                                        <input type="password" class="form-control" id="newPassword" required minlength="6">
                                        <small class="text-muted">Password must be at least 6 characters</small>
                                    </div>
                                    <div class="form-group mb-3">
                                        <label for="confirmPassword" class="form-label">Confirm New Password</label>
                                        <input type="password" class="form-control" id="confirmPassword" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-shield-check"></i> Change Password
                                    </button>
                                </form>
                                <div id="passwordChangeMessage" class="mt-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Account Management -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-gear"></i> Account Settings</h5>
                            </div>
                            <div class="card-body">
                                <div class="form-group mb-3">
                                    <label class="form-label">Email Notifications</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="emailReminders" checked>
                                        <label class="form-check-label" for="emailReminders">
                                            Daily progress reminders
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="contestNotifications" checked>
                                        <label class="form-check-label" for="contestNotifications">
                                            Contest announcements
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group mb-3">
                                    <label class="form-label">Default View</label>
                                    <select class="form-select" id="defaultView">
                                        <option value="dashboard">Dashboard</option>
                                        <option value="daily">Daily Log</option>
                                        <option value="tasks">Task Manager</option>
                                        <option value="analytics">Analytics</option>
                                    </select>
                                </div>
                                
                                <button type="button" class="btn btn-success" id="saveSettings">
                                    <i class="bi bi-check-circle"></i> Save Settings
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Management -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-database"></i> Data Management</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button type="button" class="btn btn-info" id="exportData">
                                        <i class="bi bi-download"></i> Export All Data
                                    </button>
                                    <button type="button" class="btn btn-warning" id="importData">
                                        <i class="bi bi-upload"></i> Import Data
                                    </button>
                                    <hr>
                                    <button type="button" class="btn btn-danger" id="deleteAccount" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                                        <i class="bi bi-trash"></i> Delete Account
                                    </button>
                                </div>
                                <input type="file" id="importFile" accept=".json" style="display: none;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Task Modal -->
    <div class="modal fade" id="taskModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Task</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="taskForm">
                        <div class="mb-3">
                            <label class="form-label">Task Name</label>
                            <input type="text" class="form-control" id="taskName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Task Type</label>
                            <select class="form-select" id="taskType" required>
                                <option value="problem-solving">Problem Solving</option>
                                <option value="topic-learning">Topic Learning</option>
                                <option value="contest-prep">Contest Preparation</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Target (Problems/Topics)</label>
                            <input type="number" class="form-control" id="taskTarget" min="1" value="1">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Priority</label>
                            <select class="form-select" id="taskPriority">
                                <option value="1">⭐ Low</option>
                                <option value="2">⭐⭐ Medium</option>
                                <option value="3" selected>⭐⭐⭐ High</option>
                                <option value="4">⭐⭐⭐⭐ Urgent</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Due Date</label>
                            <input type="date" class="form-control" id="taskDueDate">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Topic (if applicable)</label>
                            <input type="text" class="form-control" id="taskTopic" placeholder="e.g., Dynamic Programming">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes / Plan</label>
                            <textarea class="form-control" id="taskNotes" rows="3" placeholder="Describe your plan, approach, or any notes for this task..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveTask">Save Task</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Contest Modal -->
    <div class="modal fade" id="addContestModal" tabindex="-1" aria-labelledby="addContestModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addContestModalLabel">Add Contest</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="contestForm">
                        <div class="form-group">
                            <label for="contestDate">Date</label>
                            <input type="date" class="form-control" id="contestDate" required>
                        </div>
                        <div class="form-group">
                            <label for="contestPlatform">Platform</label>
                            <select class="form-control" id="contestPlatform" required>
                                <option value="">Select Platform</option>
                                <option value="CF">Codeforces (CF)</option>
                                <option value="AC">AtCoder (AC)</option>
                                <option value="LC">LeetCode (LC)</option>
                                <option value="CC">CodeChef (CC)</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="contestName">Contest Name</label>
                            <input type="text" class="form-control" id="contestName" required>
                        </div>
                        <div class="form-group">
                            <label for="contestSolved">Problems Solved</label>
                            <input type="number" class="form-control" id="contestSolved" required>
                        </div>
                        <div class="form-group">
                            <label for="contestRating">Rating Change</label>
                            <input type="number" class="form-control" id="contestRating">
                        </div>
                        <div class="form-group">
                            <label for="contestRank">Rank</label>
                            <input type="number" class="form-control" id="contestRank">
                        </div>
                        <div class="form-group">
                            <label for="contestUpsolved">Upsolved?</label>
                            <select class="form-control" id="contestUpsolved">
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="contestNotes">Notes</label>
                            <textarea class="form-control" id="contestNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveContest">Save</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Daily Log Modal -->
    <div class="modal fade" id="addDailyModal" tabindex="-1" aria-labelledby="addDailyModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addDailyModalLabel">Add Daily Log</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Username Settings -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0">Auto-fetch Settings</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="cfUsernames">Codeforces Usernames</label>
                                        <textarea class="form-control" id="cfUsernames" rows="2" placeholder="username1, username2, username3..."></textarea>
                                        <small class="text-muted">Separate multiple usernames with commas</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="atcoderUsernames">AtCoder Usernames</label>
                                        <textarea class="form-control" id="atcoderUsernames" rows="2" placeholder="username1, username2, username3..."></textarea>
                                        <small class="text-muted">Separate multiple usernames with commas</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="codechefUsernames">CodeChef Usernames</label>
                                        <textarea class="form-control" id="codechefUsernames" rows="2" placeholder="username1, username2, username3..."></textarea>
                                        <small class="text-muted">Separate multiple usernames with commas</small>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-info btn-sm" id="autoFetchBtn">
                                <i class="bi bi-download"></i> Auto-fetch from CF, AtCoder & CodeChef
                            </button>
                            <small class="text-muted d-block mt-1">This will automatically fill CF, AC, and CC solved counts for the selected date</small>
                        </div>
                    </div>
                    
                    <form id="dailyForm">
                        <div class="form-group">
                            <label for="dailyDate">Date</label>
                            <input type="date" class="form-control" id="dailyDate" required>
                        </div>
                        <div class="form-group">
                            <label for="cfProblems">CF Problems Solved</label>
                            <input type="number" class="form-control" id="cfProblems">
                        </div>
                        <div class="form-group">
                            <label for="atcoderProblems">AC Problems Solved</label>
                            <input type="number" class="form-control" id="atcoderProblems">
                        </div>
                        <div class="form-group">
                            <label for="ccProblems">CC Problems Solved</label>
                            <input type="number" class="form-control" id="ccProblems">
                        </div>
                        <div class="form-group">
                            <label for="dailyHours">Hours Practiced</label>
                            <input type="number" step="0.1" class="form-control" id="dailyHours">
                        </div>
                        <div class="form-group">
                            <label for="dailyContest">Contest?</label>
                            <select class="form-control" id="dailyContest">
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dailyNotes">Notes</label>
                            <textarea class="form-control" id="dailyNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveDaily">Save</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Mistake Modal -->
    <div class="modal fade" id="addMistakeModal" tabindex="-1" aria-labelledby="addMistakeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addMistakeModalLabel">Add Mistake</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="mistakeForm">
                        <div class="form-group">
                            <label for="mistakeDate">Date</label>
                            <input type="date" class="form-control" id="mistakeDate" required>
                        </div>
                        <div class="form-group">
                            <label for="mistakePlatform">Platform</label>
                            <select class="form-control" id="mistakePlatform" required>
                                <option value="">Select Platform</option>
                                <option value="CF">Codeforces (CF)</option>
                                <option value="AC">AtCoder (AC)</option>
                                <option value="LC">LeetCode (LC)</option>
                                <option value="CC">CodeChef (CC)</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="mistakeProblem">Problem</label>
                            <input type="text" class="form-control" id="mistakeProblem" required>
                        </div>
                        <div class="form-group">
                            <label for="mistakeType">Mistake Type</label>
                            <select class="form-control" id="mistakeType" required>
                                <option value="">Select Type</option>
                                <option value="WA">Wrong Answer (WA)</option>
                                <option value="TLE">Time Limit Exceeded (TLE)</option>
                                <option value="MLE">Memory Limit Exceeded (MLE)</option>
                                <option value="RE">Runtime Error (RE)</option>
                                <option value="CE">Compilation Error (CE)</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="mistakeReason">Reason</label>
                            <input type="text" class="form-control" id="mistakeReason" required>
                        </div>
                        <div class="form-group">
                            <label for="mistakeFix">Fix Strategy</label>
                            <textarea class="form-control" id="mistakeFix" rows="3" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveMistake">Save</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Topic Modal -->
    <div class="modal fade" id="addTopicModal" tabindex="-1" aria-labelledby="addTopicModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addTopicModalLabel">Add Topic</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="topicForm">
                        <div class="form-group">
                            <label for="topicName">Topic</label>
                            <input type="text" class="form-control" id="topicName" required>
                        </div>
                        <div class="form-group">
                            <label for="topicSolved">Problems Solved</label>
                            <input type="number" class="form-control" id="topicSolved" required>
                        </div>
                        <div class="form-group">
                            <label for="topicConfidence">Confidence (1-5)</label>
                            <select class="form-control" id="topicConfidence" required>
                                <option value="">Select Confidence Level</option>
                                <option value="1">1 - Very Low</option>
                                <option value="2">2 - Low</option>
                                <option value="3">3 - Moderate</option>
                                <option value="4">4 - High</option>
                                <option value="5">5 - Very High</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="topicLastPracticed">Last Practiced</label>
                            <input type="date" class="form-control" id="topicLastPracticed" required>
                        </div>
                        <div class="form-group">
                            <label for="topicNotes">Notes</label>
                            <textarea class="form-control" id="topicNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveTopic">Save</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Entry</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editId">
                        <input type="hidden" id="editType">
                        <input type="hidden" id="editField">
                        <div id="editFields"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveEdit">Save Changes</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Delete Account Confirmation Modal -->
    <div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteAccountModalLabel">⚠️ Delete Account</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <strong>Warning:</strong> This action cannot be undone!
                    </div>
                    <p>Deleting your account will permanently remove:</p>
                    <ul>
                        <li>All your contest logs</li>
                        <li>All daily progress data</li>
                        <li>All mistake logs and topics</li>
                        <li>All task manager data</li>
                        <li>Your account settings</li>
                    </ul>
                    <p>Please type <strong>DELETE</strong> to confirm:</p>
                    <input type="text" class="form-control" id="deleteConfirmation" placeholder="Type DELETE to confirm">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteAccount" disabled>Delete My Account</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase and other scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    
    <script>
  const firebaseConfig = {
  apiKey: "AIzaSyBhDemnqt43w4kJ5Sb1xCghly1yIbMjEfc",
  authDomain: "cp-tracker-f47ec.firebaseapp.com",
  databaseURL: "https://cp-tracker-f47ec-default-rtdb.firebaseio.com",
  projectId: "cp-tracker-f47ec",
  storageBucket: "cp-tracker-f47ec.firebasestorage.app",
  messagingSenderId: "635820621186",
  appId: "1:635820621186:web:058f3e3ab847378cc3239b",
  measurementId: "G-JVLSXH9QDX"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // App data
        let contests = [];
        let dailyLogs = [];
        let mistakes = [];
        let topics = [];
        let tasks = [];
        let currentUser = null;
        let solvedChart, mistakesChart, topicsChart;

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            setupAuth();
            setupNavigation();
            setupModals();
            setupEditFunctionality();
            setupSaveEditHandler();
            setupTaskManager();
            setupAnalyticsButtons();
            setupAutoFetch();
            setupProfileSettings();
            setDefaultDates();
        });

        // Authentication setup
        function setupAuth() {
            // Listen for auth state changes
            auth.onAuthStateChanged(user => {
                if (user) {
                    // User is signed in
                    currentUser = user;
                    document.getElementById('auth-container').style.display = 'none';
                    document.getElementById('app-container').style.display = 'block';
                    
                    // Update user email in header
                    const userEmailHeader = document.getElementById('user-email-header');
                    if (userEmailHeader) {
                        const email = user.email;
                        const displayName = email.split('@')[0]; // Show username part before @
                        userEmailHeader.textContent = displayName;
                    }
                    
                    loadAllData();
                    // Ensure save edit handler is ready after login
                    setTimeout(() => {
                        setupSaveEditHandler();
                        console.log('Save edit handler re-initialized after login');
                    }, 500);
                    // Update profile information when user signs in
                    updateProfileInfo();
                } else {
                    // No user is signed in
                    currentUser = null;
                    document.getElementById('auth-container').style.display = 'flex';
                    document.getElementById('app-container').style.display = 'none';
                }
            });

            // Setup initial authentication listeners
            setupAuthListeners();
        }

        // Show forgot password form
        function showForgotPasswordForm() {
            const authBox = document.getElementById('auth-box');
            authBox.innerHTML = `
                <h3 class="text-center mb-4">Reset Password</h3>
                <div class="form-group">
                    <input type="email" id="reset-email" class="form-control" placeholder="Enter your email address" required>
                </div>
                <button id="send-reset-btn" class="btn btn-primary w-100 mb-2">
                    <i class="bi bi-envelope"></i> Send Reset Email
                </button>
                <button id="back-to-login-btn" class="btn btn-link w-100 text-decoration-none">
                    <i class="bi bi-arrow-left"></i> Back to Login
                </button>
                <div id="reset-message" class="mt-3 text-center"></div>
            `;

            // Send reset email button
            document.getElementById('send-reset-btn').addEventListener('click', () => {
                const email = document.getElementById('reset-email').value;
                const resetMessage = document.getElementById('reset-message');
                const sendResetBtn = document.getElementById('send-reset-btn');
                
                if (!email) {
                    resetMessage.className = 'mt-3 text-center text-danger';
                    resetMessage.textContent = 'Please enter your email address.';
                    return;
                }

                // Show loading state
                sendResetBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Sending...';
                sendResetBtn.disabled = true;
                resetMessage.textContent = '';

                auth.sendPasswordResetEmail(email)
                    .then(() => {
                        resetMessage.className = 'mt-3 text-center text-success';
                        resetMessage.textContent = 'Password reset email sent! Check your inbox.';
                        sendResetBtn.innerHTML = '<i class="bi bi-check-circle"></i> Email Sent';
                        
                        // Show success toast notification
                        showToast('Password reset email sent successfully!', 'success');
                        
                        // Auto return to login after 3 seconds
                        setTimeout(() => {
                            showLoginForm();
                        }, 3000);
                    })
                    .catch((error) => {
                        resetMessage.className = 'mt-3 text-center text-danger';
                        resetMessage.textContent = error.message;
                        sendResetBtn.innerHTML = '<i class="bi bi-envelope"></i> Send Reset Email';
                        sendResetBtn.disabled = false;
                        
                        // Show error toast notification
                        showToast('Failed to send reset email: ' + error.message, 'error');
                    });
            });

            // Back to login button
            document.getElementById('back-to-login-btn').addEventListener('click', () => {
                showLoginForm();
            });
        }

        // Show login form (restore original login form)
        function showLoginForm() {
            const authBox = document.getElementById('auth-box');
            authBox.innerHTML = `
                <h3 class="text-center mb-4">CP Tracker Login</h3>
                <div class="form-group">
                    <input type="email" id="email" class="form-control" placeholder="Email">
                </div>
                <div class="form-group">
                    <input type="password" id="password" class="form-control" placeholder="Password">
                </div>
                <button id="login-btn" class="btn btn-primary w-100 mb-2">Login</button>
                <button id="signup-btn" class="btn btn-secondary w-100 mb-2">Sign Up</button>
                <button id="forgot-password-btn" class="btn btn-link w-100 text-decoration-none">
                    <i class="bi bi-key"></i> Forgot Password?
                </button>
                <div id="auth-message" class="mt-3 text-center text-danger"></div>
            `;

            // Re-setup event listeners
            setupAuthListeners();
        }

        // Setup authentication event listeners
        function setupAuthListeners() {
            // Login button
            document.getElementById('login-btn').addEventListener('click', () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const authMessage = document.getElementById('auth-message');
                
                authMessage.textContent = '';
                
                auth.signInWithEmailAndPassword(email, password)
                    .catch(error => {
                        authMessage.textContent = error.message;
                    });
            });

            // Signup button
            document.getElementById('signup-btn').addEventListener('click', () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const authMessage = document.getElementById('auth-message');
                
                authMessage.textContent = '';
                
                auth.createUserWithEmailAndPassword(email, password)
                    .catch(error => {
                        authMessage.textContent = error.message;
                    });
            });

            // Forgot password button
            document.getElementById('forgot-password-btn').addEventListener('click', () => {
                showForgotPasswordForm();
            });
        }

        // Toast notification function
        function showToast(message, type = 'info') {
            // Create toast container if it doesn't exist
            let toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.className = 'toast-container';
                document.body.appendChild(toastContainer);
            }

            const toastId = 'toast_' + Date.now();
            const iconClass = type === 'success' ? 'bi-check-circle-fill text-success' : 
                             type === 'error' ? 'bi-exclamation-triangle-fill text-danger' : 
                             'bi-info-circle-fill text-primary';

            const toastHtml = `
                <div class="toast custom-toast" id="${toastId}" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000">
                    <div class="toast-header">
                        <i class="bi ${iconClass} me-2"></i>
                        <strong class="me-auto">CP Tracker</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            `;

            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement);
            toast.show();

            // Remove from DOM after hiding
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }

        // Confirm logout function
        function confirmLogout() {
            // Create confirmation modal
            const modalHtml = `
                <div class="modal fade" id="logoutConfirmModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="bi bi-box-arrow-right text-warning me-2"></i>
                                    Confirm Logout
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p class="mb-3">Are you sure you want to logout from CP Tracker?</p>
                                <div class="alert alert-info d-flex align-items-center" role="alert">
                                    <i class="bi bi-info-circle me-2"></i>
                                    <div>Your data will be saved automatically and you can login again anytime.</div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    <i class="bi bi-x-circle me-2"></i>Cancel
                                </button>
                                <button type="button" class="btn btn-danger" onclick="performLogout()">
                                    <i class="bi bi-box-arrow-right me-2"></i>Yes, Logout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Remove existing modal if any
            const existingModal = document.getElementById('logoutConfirmModal');
            if (existingModal) {
                existingModal.remove();
            }

            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('logoutConfirmModal'));
            modal.show();

            // Clean up modal after hiding
            document.getElementById('logoutConfirmModal').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }

        // Perform logout function
        function performLogout() {
            const modal = bootstrap.Modal.getInstance(document.getElementById('logoutConfirmModal'));
            modal.hide();

            // Show loading toast
            showToast('Logging out...', 'info');

            // Sign out from Firebase
            auth.signOut().then(() => {
                showToast('Successfully logged out. See you soon!', 'success');
            }).catch((error) => {
                showToast('Error logging out: ' + error.message, 'error');
            });
        }

        // Load data from Firebase
        function loadAllData() {
            if (!currentUser) return;
            
            const userId = currentUser.uid;
            
            // Load contests
            database.ref(`users/${userId}/contests`).on('value', snapshot => {
                const data = snapshot.val();
                contests = data ? Object.values(data) : [];
                console.log('Loaded contests:', contests); // Debug log
                renderContests();
                updateDashboardStats();
                updateRecentContests();
                updateCharts();
            });
            
            // Load daily logs
            database.ref(`users/${userId}/dailyLogs`).on('value', snapshot => {
                const data = snapshot.val();
                dailyLogs = data ? Object.values(data) : [];
                console.log('Loaded dailyLogs:', dailyLogs); // Debug log
                renderDailyLogs();
                updateDashboardStats();
                updateCharts();
            });
            
            // Load mistakes
            database.ref(`users/${userId}/mistakes`).on('value', snapshot => {
                const data = snapshot.val();
                mistakes = data ? Object.values(data) : [];
                console.log('Loaded mistakes:', mistakes); // Debug log
                renderMistakes();
                updateDashboardStats();
                updateRecentMistakes();
                updateCharts();
            });
            
            // Load topics
            database.ref(`users/${userId}/topics`).on('value', snapshot => {
                const data = snapshot.val();
                topics = data ? Object.values(data) : [];
                console.log('Loaded topics:', topics); // Debug log
                renderTopics();
                updateDashboardStats();
                updateTopicsToImprove();
                updateCharts();
            });
            
            // Load tasks
            database.ref(`users/${userId}/tasks`).on('value', snapshot => {
                const data = snapshot.val();
                tasks = data ? Object.values(data) : [];
                console.log('Loaded tasks:', tasks); // Debug log
                renderTasks();
                updateDashboardStats();
            });
        }

        // Save data to Firebase
        function saveData(type, data) {
            console.log('saveData called with:', { type, data, currentUser: !!currentUser }); // Debug log
            if (!currentUser) {
                console.error('No current user, cannot save data');
                return;
            }
            const userId = currentUser.uid;
            
            // Convert array data to object format for Firebase
            const dataToSave = {};
            if (Array.isArray(data)) {
                data.forEach(item => {
                    if (item.id) {
                        dataToSave[item.id] = item;
                    }
                });
            } else {
                // If it's already an object, use as is
                Object.assign(dataToSave, data);
            }
            
            console.log('Saving to Firebase:', `users/${userId}/${type}`, dataToSave); // Debug log
            database.ref(`users/${userId}/${type}`).set(dataToSave)
                .then(() => {
                    console.log('Data saved successfully to Firebase');
                })
                .catch((error) => {
                    console.error('Error saving data to Firebase:', error);
                });
        }

        // Navigation setup
        function setupNavigation() {
            // Handle sidebar navigation links
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active link
                    document.querySelectorAll('.sidebar .nav-link').forEach(navLink => {
                        navLink.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Hide all sections
                    document.querySelectorAll('[id$="-section"]').forEach(section => {
                        section.style.display = 'none';
                    });
                    
                    // Show selected section
                    const sectionAttribute = this.getAttribute('data-section');
                    if (!sectionAttribute) {
                        console.warn('Navigation link missing data-section attribute:', this);
                        return;
                    }
                    
                    const sectionId = sectionAttribute + '-section';
                    const sectionElement = document.getElementById(sectionId);
                    if (sectionElement) {
                        sectionElement.style.display = 'block';
                    } else {
                        console.warn('Section not found:', sectionId);
                    }
                    
                    // Update charts when analytics section is shown
                    if (sectionId === 'analytics-section') {
                        setTimeout(() => {
                            updateCharts();
                            updateDailyProgressAnalytics();
                            updateAdvancedAnalytics();
                        }, 100);
                    }
                    
                    // Update profile when profile section is shown
                    if (sectionId === 'profile-section') {
                        setTimeout(() => {
                            updateProfileInfo();
                        }, 100);
                    }
                });
            });

            // Handle dropdown navigation links
            document.querySelectorAll('.dropdown-item[data-section]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update sidebar active link
                    document.querySelectorAll('.sidebar .nav-link').forEach(navLink => {
                        navLink.classList.remove('active');
                    });
                    
                    const sectionAttribute = this.getAttribute('data-section');
                    const correspondingSidebarLink = document.querySelector(`.sidebar .nav-link[data-section="${sectionAttribute}"]`);
                    if (correspondingSidebarLink) {
                        correspondingSidebarLink.classList.add('active');
                    }
                    
                    // Hide all sections
                    document.querySelectorAll('[id$="-section"]').forEach(section => {
                        section.style.display = 'none';
                    });
                    
                    // Show selected section
                    const sectionId = sectionAttribute + '-section';
                    const targetSection = document.getElementById(sectionId);
                    
                    if (targetSection) {
                        targetSection.style.display = 'block';
                        console.log('Navigated to section:', sectionId);
                    } else {
                        console.warn('Section not found:', sectionId);
                    }
                    
                    // Update profile when profile section is shown
                    if (sectionId === 'profile-section') {
                        setTimeout(() => {
                            updateProfileInfo();
                        }, 100);
                    }
                });
            });
        }

        // Task Manager Setup
        function setupTaskManager() {
            // Add Task Button
            document.getElementById('add-task-btn').addEventListener('click', function() {
                // Reset form and set default date to today
                document.getElementById('taskForm').reset();
                document.getElementById('taskDueDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('saveTask').textContent = 'Save Task';
                document.getElementById('saveTask').onclick = saveNewTask;
                
                const modal = new bootstrap.Modal(document.getElementById('taskModal'));
                modal.show();
            });

            // Save Task
            function saveNewTask() {
                const newTask = {
                    id: tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1,
                    name: document.getElementById('taskName').value,
                    type: document.getElementById('taskType').value,
                    target: parseInt(document.getElementById('taskTarget').value) || 1,
                    completed: 0,
                    priority: parseInt(document.getElementById('taskPriority').value) || 3,
                    dueDate: document.getElementById('taskDueDate').value,
                    topic: document.getElementById('taskTopic').value || '',
                    notes: document.getElementById('taskNotes').value || '',
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                
                tasks.push(newTask);
                saveData('tasks', tasks);
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('taskModal')).hide();
            }

            // Task tab navigation
            document.querySelectorAll('[data-task-tab]').forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active tab
                    document.querySelectorAll('[data-task-tab]').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Filter tasks
                    const tab = this.getAttribute('data-task-tab');
                    renderTasks(tab);
                });
            });
        }

        // Render tasks with optional filtering
        function renderTasks(filter = 'active') {
            const table = document.getElementById('task-table');
            table.innerHTML = '';
            
            let filteredTasks = tasks;
            
            // Apply filter
            if (filter === 'active') {
                filteredTasks = tasks.filter(t => t.status !== 'completed');
            } else if (filter === 'completed') {
                filteredTasks = tasks.filter(t => t.status === 'completed');
            }
            
            if (filteredTasks.length === 0) {
                table.innerHTML = '<tr><td colspan="7" class="text-center">No tasks found</td></tr>';
                return;
            }
            
            // Sort tasks by priority and due date
            filteredTasks.sort((a, b) => {
                if (a.priority !== b.priority) return b.priority - a.priority;
                if (!a.dueDate && !b.dueDate) return 0;
                if (!a.dueDate) return 1;
                if (!b.dueDate) return -1;
                return new Date(a.dueDate) - new Date(b.dueDate);
            });
            
            filteredTasks.forEach(task => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', task.id);
                
                if (task.status === 'completed') {
                    row.classList.add('completed-task');
                }
                
                // Calculate progress
                const progress = task.completed / task.target * 100;
                const progressColor = progress >= 100 ? 'bg-success' : 
                                    progress >= 50 ? 'bg-primary' : 'bg-warning';
                
                // Format due date
                let dueDateDisplay = task.dueDate || 'No deadline';
                if (task.dueDate) {
                    const dueDate = new Date(task.dueDate);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    if (dueDate < today && task.status !== 'completed') {
                        dueDateDisplay = `<span class="text-danger">${task.dueDate} (Overdue)</span>`;
                    } else {
                        dueDateDisplay = task.dueDate;
                    }
                }
                
                row.innerHTML = `
                    <td>${task.name} ${task.topic ? `<br><small class="text-muted">Topic: ${task.topic}</small>` : ''}</td>
                    <td>${formatTaskType(task.type)}</td>
                    <td>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar ${progressColor}" role="progressbar" 
                                style="width: ${progress}%" aria-valuenow="${progress}" 
                                aria-valuemin="0" aria-valuemax="100">
                                ${task.completed}/${task.target}
                            </div>
                        </div>
                    </td>
                    <td>${'⭐'.repeat(task.priority)}</td>
                    <td>${dueDateDisplay}</td>
                    <td>
                        <select class="form-select form-select-sm task-status" data-id="${task.id}">
                            <option value="pending" ${task.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="in-progress" ${task.status === 'in-progress' ? 'selected' : ''}>In Progress</option>
                            <option value="completed" ${task.status === 'completed' ? 'selected' : ''}>Completed</option>
                        </select>
                    </td>
                    <td class="text-muted" style="max-width: 200px;">
                        <small>${task.notes ? task.notes.substring(0, 50) + (task.notes.length > 50 ? '...' : '') : '-'}</small>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-success increment-task" data-id="${task.id}" title="Add +1" ${task.status === 'completed' ? 'disabled' : ''}>
                                <i class="bi bi-plus"></i>
                            </button>
                            <button class="btn btn-warning decrement-task" data-id="${task.id}" title="Subtract -1" ${task.completed === 0 ? 'disabled' : ''}>
                                <i class="bi bi-dash"></i>
                            </button>
                            <button class="btn btn-primary edit-task" data-id="${task.id}" title="Edit">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-danger delete-task" data-id="${task.id}" title="Delete">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                table.appendChild(row);
            });
            
            // Add event listeners
            document.querySelectorAll('.increment-task').forEach(btn => {
                btn.addEventListener('click', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    const task = tasks.find(t => t.id === taskId);
                    if (task && task.completed < task.target) {
                        task.completed++;
                        if (task.completed >= task.target) {
                            task.status = 'completed';
                        }
                        saveData('tasks', tasks);
                    }
                });
            });
            
            document.querySelectorAll('.decrement-task').forEach(btn => {
                btn.addEventListener('click', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    const task = tasks.find(t => t.id === taskId);
                    if (task && task.completed > 0) {
                        task.completed--;
                        if (task.completed < task.target) {
                            task.status = 'in-progress';
                        }
                        saveData('tasks', tasks);
                    }
                });
            });
            
            document.querySelectorAll('.delete-task').forEach(btn => {
                btn.addEventListener('click', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    tasks = tasks.filter(t => t.id !== taskId);
                    saveData('tasks', tasks);
                });
            });
            
            document.querySelectorAll('.edit-task').forEach(btn => {
                btn.addEventListener('click', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    const task = tasks.find(t => t.id === taskId);
                    if (task) {
                        // Populate the task form
                        document.getElementById('taskName').value = task.name;
                        document.getElementById('taskType').value = task.type;
                        document.getElementById('taskTarget').value = task.target;
                        document.getElementById('taskPriority').value = task.priority;
                        document.getElementById('taskDueDate').value = task.dueDate;
                        document.getElementById('taskTopic').value = task.topic || '';
                        document.getElementById('taskNotes').value = task.notes || '';
                        
                        // Change save button to update
                        document.getElementById('saveTask').textContent = 'Update Task';
                        document.getElementById('saveTask').onclick = function() {
                            task.name = document.getElementById('taskName').value;
                            task.type = document.getElementById('taskType').value;
                            task.target = parseInt(document.getElementById('taskTarget').value) || 1;
                            task.priority = parseInt(document.getElementById('taskPriority').value) || 3;
                            task.dueDate = document.getElementById('taskDueDate').value;
                            task.topic = document.getElementById('taskTopic').value || '';
                            task.notes = document.getElementById('taskNotes').value || '';
                            
                            saveData('tasks', tasks);
                            bootstrap.Modal.getInstance(document.getElementById('taskModal')).hide();
                        };
                        
                        // Show the modal
                        const modal = new bootstrap.Modal(document.getElementById('taskModal'));
                        modal.show();
                    }
                });
            });
            
            document.querySelectorAll('.task-status').forEach(select => {
                select.addEventListener('change', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    const task = tasks.find(t => t.id === taskId);
                    if (task) {
                        task.status = this.value;
                        if (this.value === 'completed' && task.completed < task.target) {
                            task.completed = task.target;
                        }
                        saveData('tasks', tasks);
                    }
                });
            });
            
            // Update active tasks in dashboard
            updateActiveTasks();
        }

        function formatTaskType(type) {
            const types = {
                'problem-solving': 'Problem Solving',
                'topic-learning': 'Topic Learning',
                'contest-prep': 'Contest Prep',
                'other': 'Other'
            };
            return types[type] || type;
        }

        function updateActiveTasks() {
            const activeTasksContainer = document.getElementById('active-tasks');
            activeTasksContainer.innerHTML = '';
            
            const activeTasks = tasks.filter(t => t.status !== 'completed').slice(0, 5);
            
            if (activeTasks.length === 0) {
                activeTasksContainer.innerHTML = '<div class="text-center text-muted">No active tasks</div>';
                return;
            }
            
            activeTasks.forEach(task => {
                const progress = task.completed / task.target * 100;
                const progressColor = progress >= 100 ? 'bg-success' : 
                                    progress >= 50 ? 'bg-primary' : 'bg-warning';
                
                const taskEl = document.createElement('div');
                taskEl.className = 'card mb-2 task-card';
                taskEl.innerHTML = `
                    <div class="card-body">
                        <h6 class="card-title">${task.name}</h6>
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <small class="text-muted">${formatTaskType(task.type)}</small>
                                ${task.topic ? `<br><small class="text-muted">Topic: ${task.topic}</small>` : ''}
                            </div>
                            <div>
                                <span class="badge bg-${task.priority >= 3 ? 'danger' : 'warning'}">
                                    ${'⭐'.repeat(task.priority)}
                                </span>
                            </div>
                        </div>
                        <div class="progress mt-2" style="height: 10px;">
                            <div class="progress-bar ${progressColor}" 
                                style="width: ${progress}%"></div>
                        </div>
                        <div class="d-flex justify-content-between mt-2">
                            <small>${task.completed}/${task.target}</small>
                            <small>${task.dueDate ? `Due: ${task.dueDate}` : 'No deadline'}</small>
                        </div>
                    </div>
                `;
                
                activeTasksContainer.appendChild(taskEl);
            });
        }

        // Update recent contests
        function updateRecentContests() {
            const container = document.getElementById('recent-contests');
            container.innerHTML = '';
            
            if (contests.length === 0) {
                container.innerHTML = '<div class="text-center text-muted p-3">No contests yet</div>';
                return;
            }
            
            // Sort by date descending and take first 5
            const recentContests = [...contests]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            recentContests.forEach(contest => {
                const item = document.createElement('div');
                item.className = 'recent-item';
                
                // Format rating change with color
                let ratingChange = contest.rating_change || 0;
                let ratingClass = ratingChange > 0 ? 'text-success' : ratingChange < 0 ? 'text-danger' : 'text-muted';
                let ratingDisplay = ratingChange > 0 ? `+${ratingChange}` : ratingChange;
                
                item.innerHTML = `
                    <div class="d-flex justify-content-between">
                        <strong>${contest.contest_name}</strong>
                        <span class="badge bg-secondary">${contest.platform}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <small>${contest.date}</small>
                        <small class="${ratingClass}">${ratingDisplay}</small>
                    </div>
                    <div class="d-flex justify-content-between">
                        <small>Solved: ${contest.solved}</small>
                        <small>Rank: ${contest.rank || '-'}</small>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        // Update recent mistakes
        function updateRecentMistakes() {
            const container = document.getElementById('recent-mistakes');
            container.innerHTML = '';
            
            if (mistakes.length === 0) {
                container.innerHTML = '<div class="text-center text-muted p-3">No mistakes yet</div>';
                return;
            }
            
            // Sort by date descending and take first 5
            const recentMistakes = [...mistakes]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            recentMistakes.forEach(mistake => {
                const item = document.createElement('div');
                item.className = 'recent-item';
                
                item.innerHTML = `
                    <div class="d-flex justify-content-between">
                        <strong>${mistake.problem}</strong>
                        <span class="badge bg-secondary">${mistake.platform}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <small>${mistake.date}</small>
                        <small class="text-danger">${mistake.mistake_type}</small>
                    </div>
                    <div><small>${mistake.reason}</small></div>
                `;
                
                container.appendChild(item);
            });
        }

        // Update topics to improve
        function updateTopicsToImprove() {
            const container = document.getElementById('topics-to-improve');
            container.innerHTML = '';
            
            if (topics.length === 0) {
                container.innerHTML = '<div class="text-center text-muted p-3">No topics yet</div>';
                return;
            }
            
            // Filter topics with confidence <= 3 and sort by confidence ascending
            const topicsToImprove = [...topics]
                .filter(topic => topic.confidence <= 3)
                .sort((a, b) => a.confidence - b.confidence)
                .slice(0, 5);
            
            if (topicsToImprove.length === 0) {
                container.innerHTML = '<div class="text-center text-muted p-3">All topics look good!</div>';
                return;
            }
            
            topicsToImprove.forEach(topic => {
                const item = document.createElement('div');
                item.className = 'topic-to-improve';
                
                item.innerHTML = `
                    <div>
                        <strong>${topic.topic}</strong>
                        <div class="confidence-stars">
                            ${'★'.repeat(topic.confidence)}${'☆'.repeat(5 - topic.confidence)}
                        </div>
                    </div>
                    <div>
                        <small>${topic.solved} solved</small>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        // Update daily progress analytics
        function updateDailyProgressAnalytics() {
            const today = new Date().toISOString().split('T')[0];
            const threeDaysAgo = new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

            // Calculate today's progress
            const todayLogs = dailyLogs.filter(log => log.date === today);
            const todayProgress = todayLogs.reduce((sum, log) => 
                sum + (parseInt(log.cf_solved) || 0) + (parseInt(log.ac_solved) || 0) + (parseInt(log.cc_solved) || 0), 0
            );

            // Calculate 3-day progress
            const threeDayLogs = dailyLogs.filter(log => log.date >= threeDaysAgo);
            const threeDayProgress = threeDayLogs.reduce((sum, log) => 
                sum + (parseInt(log.cf_solved) || 0) + (parseInt(log.ac_solved) || 0) + (parseInt(log.cc_solved) || 0), 0
            );

            // Calculate weekly progress
            const weekLogs = dailyLogs.filter(log => log.date >= weekAgo);
            const weekProgress = weekLogs.reduce((sum, log) => 
                sum + (parseInt(log.cf_solved) || 0) + (parseInt(log.ac_solved) || 0) + (parseInt(log.cc_solved) || 0), 0
            );

            // Calculate topics practiced in last 3 days
            const topicsInThreeDays = topics.filter(topic => 
                topic.last_practiced >= threeDaysAgo
            ).length;

            // Update the display
            document.getElementById('today-progress').textContent = todayProgress;
            document.getElementById('three-days-progress').textContent = threeDayProgress;
            document.getElementById('week-progress').textContent = weekProgress;
            document.getElementById('topics-three-days').textContent = topicsInThreeDays;
        }

        // Update daily progress chart
        let dailyProgressChart, topicTimelineChart;
        function updateDailyProgressChart(days = 7) {
            const ctx = document.getElementById('dailyProgressChart').getContext('2d');
            if (dailyProgressChart) dailyProgressChart.destroy();

            // Generate last N days
            const dates = [];
            const cfData = [];
            const acData = [];
            const ccData = [];
            const contestData = [];

            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(Date.now() - i * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                dates.push(date);

                // Find daily log for this date
                const dayLog = dailyLogs.find(log => log.date === date);
                cfData.push(dayLog ? (parseInt(dayLog.cf_solved) || 0) : 0);
                acData.push(dayLog ? (parseInt(dayLog.ac_solved) || 0) : 0);
                ccData.push(dayLog ? (parseInt(dayLog.cc_solved) || 0) : 0);

                // Check if there was a contest this day
                const dayContest = contests.find(contest => contest.date === date);
                contestData.push(dayContest ? parseInt(dayContest.solved) || 0 : 0);
            }

            dailyProgressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates.map(date => new Date(date).toLocaleDateString('en-US', {month: 'short', day: 'numeric'})),
                    datasets: [{
                        label: 'Codeforces',
                        data: cfData,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        tension: 0.1,
                        fill: false
                    }, {
                        label: 'AtCoder',
                        data: acData,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        tension: 0.1,
                        fill: false
                    }, {
                        label: 'CodeChef',
                        data: ccData,
                        borderColor: 'rgba(255, 206, 86, 1)',
                        backgroundColor: 'rgba(255, 206, 86, 0.1)',
                        tension: 0.1,
                        fill: false
                    }, {
                        label: 'Contest Problems',
                        data: contestData,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: `Daily Progress by Platform - Last ${days} Days`
                        },
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Problems Solved'
                            }
                        }
                    }
                }
            });
        }

        // Update topic timeline chart
        function updateTopicTimelineChart() {
            const ctx = document.getElementById('topicTimelineChart').getContext('2d');
            if (topicTimelineChart) topicTimelineChart.destroy();

            // Get topics practiced in last 30 days
            const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            const recentTopics = topics.filter(topic => topic.last_practiced >= thirtyDaysAgo);

            // Group by date
            const topicsByDate = {};
            recentTopics.forEach(topic => {
                const date = topic.last_practiced;
                if (!topicsByDate[date]) {
                    topicsByDate[date] = 0;
                }
                topicsByDate[date]++;
            });

            // Generate last 30 days
            const dates = [];
            const topicCounts = [];

            for (let i = 29; i >= 0; i--) {
                const date = new Date(Date.now() - i * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                dates.push(date);
                topicCounts.push(topicsByDate[date] || 0);
            }

            topicTimelineChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates.map(date => new Date(date).toLocaleDateString('en-US', {month: 'short', day: 'numeric'})),
                    datasets: [{
                        label: 'Topics Practiced',
                        data: topicCounts,
                        backgroundColor: 'rgba(255, 206, 86, 0.6)',
                        borderColor: 'rgba(255, 206, 86, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Topic Learning Timeline (Last 30 Days)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            },
                            title: {
                                display: true,
                                text: 'Topics Practiced'
                            }
                        }
                    }
                }
            });
        }

        // Update charts for analytics
        function updateCharts() {
            // Update daily progress analytics
            updateDailyProgressAnalytics();
            updateDailyProgressChart();
            updateTopicTimelineChart();
            // Problems solved chart
            const solvedCtx = document.getElementById('solvedChart').getContext('2d');
            if (solvedChart) solvedChart.destroy();
            
            const solvedData = {
                labels: ['Codeforces', 'AtCoder', 'LeetCode', 'Other'],
                datasets: [{
                    label: 'Problems Solved',
                    data: [
                        dailyLogs.reduce((sum, log) => sum + (parseInt(log.cf_solved) || 0), 0),
                        dailyLogs.reduce((sum, log) => sum + (parseInt(log.ac_solved) || 0), 0),
                        0, // LeetCode data not tracked in current implementation
                        0  // Other platforms data not tracked in current implementation
                    ],
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.5)',
                        'rgba(255, 99, 132, 0.5)',
                        'rgba(255, 206, 86, 0.5)',
                        'rgba(75, 192, 192, 0.5)'
                    ],
                    borderColor: [
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 99, 132, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)'
                    ],
                    borderWidth: 1
                }]
            };
            
            solvedChart = new Chart(solvedCtx, {
                type: 'bar',
                data: solvedData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Problems Solved by Platform'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Mistakes chart
            const mistakesCtx = document.getElementById('mistakesChart').getContext('2d');
            if (mistakesChart) mistakesChart.destroy();
            
            const mistakeTypes = ['WA', 'TLE', 'MLE', 'RE', 'CE', 'Other'];
            const mistakeCounts = mistakeTypes.map(type => 
                mistakes.filter(m => m.mistake_type === type).length
            );
            
            mistakesChart = new Chart(mistakesCtx, {
                type: 'pie',
                data: {
                    labels: mistakeTypes,
                    datasets: [{
                        label: 'Mistakes by Type',
                        data: mistakeCounts,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.5)',
                            'rgba(54, 162, 235, 0.5)',
                            'rgba(255, 206, 86, 0.5)',
                            'rgba(75, 192, 192, 0.5)',
                            'rgba(153, 102, 255, 0.5)',
                            'rgba(201, 203, 207, 0.5)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(201, 203, 207, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Mistakes by Type'
                        }
                    }
                }
            });
            
            // Topics confidence chart
            const topicsCtx = document.getElementById('topicsChart').getContext('2d');
            if (topicsChart) topicsChart.destroy();
            
            const confidenceLevels = [1, 2, 3, 4, 5];
            const topicCounts = confidenceLevels.map(level => 
                topics.filter(t => t.confidence == level).length
            );
            
            topicsChart = new Chart(topicsCtx, {
                type: 'line',
                data: {
                    labels: confidenceLevels.map(l => `Level ${l}`),
                    datasets: [{
                        label: 'Topics by Confidence Level',
                        data: topicCounts,
                        fill: false,
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Topics by Confidence Level'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Setup analytics time period buttons
        function setupAnalyticsButtons() {
            document.getElementById('progress-7days').addEventListener('click', function() {
                document.querySelectorAll('[id^="progress-"]').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                updateDailyProgressChart(7);
            });

            document.getElementById('progress-14days').addEventListener('click', function() {
                document.querySelectorAll('[id^="progress-"]').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                updateDailyProgressChart(14);
            });

            document.getElementById('progress-30days').addEventListener('click', function() {
                document.querySelectorAll('[id^="progress-"]').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                updateDailyProgressChart(30);
            });
        }

        // Render functions for other sections (contests, daily logs, mistakes, topics)
        function renderContests() {
            const table = document.getElementById('contest-table');
            table.innerHTML = '';
            
            if (contests.length === 0) {
                table.innerHTML = '<tr><td colspan="9" class="text-center">No contests yet</td></tr>';
                return;
            }
            
            contests.forEach(contest => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', contest.id);
                
                row.innerHTML = `
                    <td class="editable" data-field="date">${contest.date}</td>
                    <td class="editable" data-field="platform">${contest.platform}</td>
                    <td class="editable" data-field="contest_name">${contest.contest_name}</td>
                    <td class="editable" data-field="solved">${contest.solved}</td>
                    <td class="editable" data-field="rating_change">${contest.rating_change}</td>
                    <td class="editable" data-field="rank">${contest.rank}</td>
                    <td class="editable" data-field="upsolved">${contest.upsolved}</td>
                    <td class="editable" data-field="notes">${contest.notes}</td>
                    <td>
                        <button class="btn btn-sm btn-danger delete-contest"><i class="bi bi-trash"></i></button>
                    </td>
                `;
                
                table.appendChild(row);
            });
            
            updateDashboardStats();
            updateRecentContests();
        }
        
        function renderDailyLogs() {
            const table = document.getElementById('daily-table');
            table.innerHTML = '';
            
            if (dailyLogs.length === 0) {
                table.innerHTML = '<tr><td colspan="8" class="text-center">No daily logs yet</td></tr>';
                return;
            }
            
            dailyLogs.forEach(log => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', log.id);
                
                row.innerHTML = `
                    <td class="editable" data-field="date">${log.date}</td>
                    <td class="editable" data-field="cf_solved">${log.cf_solved || ''}</td>
                    <td class="editable" data-field="ac_solved">${log.ac_solved || ''}</td>
                    <td class="editable" data-field="cc_solved">${log.cc_solved || ''}</td>
                    <td class="editable" data-field="hours">${log.hours || ''}</td>
                    <td class="editable" data-field="contest">${log.contest || ''}</td>
                    <td class="editable" data-field="notes">${log.notes || ''}</td>
                    <td>
                        <button class="btn btn-sm btn-danger delete-daily"><i class="bi bi-trash"></i></button>
                    </td>
                `;
                
                table.appendChild(row);
            });
            
            updateDashboardStats();
        }
        
        function renderMistakes() {
            const table = document.getElementById('mistake-table');
            table.innerHTML = '';
            
            if (mistakes.length === 0) {
                table.innerHTML = '<tr><td colspan="7" class="text-center">No mistakes yet</td></tr>';
                return;
            }
            
            mistakes.forEach(mistake => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', mistake.id);
                
                row.innerHTML = `
                    <td class="editable" data-field="date">${mistake.date}</td>
                    <td class="editable" data-field="platform">${mistake.platform}</td>
                    <td class="editable" data-field="problem">${mistake.problem}</td>
                    <td class="editable" data-field="mistake_type">${mistake.mistake_type}</td>
                    <td class="editable" data-field="reason">${mistake.reason}</td>
                    <td class="editable" data-field="fix_strategy">${mistake.fix_strategy}</td>
                    <td>
                        <button class="btn btn-sm btn-danger delete-mistake"><i class="bi bi-trash"></i></button>
                    </td>
                `;
                
                table.appendChild(row);
            });
            
            updateDashboardStats();
            updateRecentMistakes();
        }
        
        function renderTopics() {
            const table = document.getElementById('topic-table');
            table.innerHTML = '';
            
            if (topics.length === 0) {
                table.innerHTML = '<tr><td colspan="6" class="text-center">No topics yet</td></tr>';
                return;
            }
            
            topics.forEach(topic => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', topic.id);
                
                row.innerHTML = `
                    <td class="editable" data-field="topic">${topic.topic}</td>
                    <td class="editable" data-field="solved">${topic.solved}</td>
                    <td class="editable" data-field="confidence">${topic.confidence}</td>
                    <td class="editable" data-field="last_practiced">${topic.last_practiced}</td>
                    <td class="editable" data-field="notes">${topic.notes || ''}</td>
                    <td>
                        <button class="btn btn-sm btn-danger delete-topic"><i class="bi bi-trash"></i></button>
                    </td>
                `;
                
                table.appendChild(row);
            });
            
            updateDashboardStats();
            updateTopicsToImprove();
        }

        // Update dashboard stats
        function updateDashboardStats() {
            // Total contests
            document.getElementById('total-contests').textContent = contests.length;
            
            // Total problems solved
            const contestSolved = contests.reduce((sum, contest) => sum + (parseInt(contest.solved) || 0), 0);
            const dailySolved = dailyLogs.reduce((sum, log) => 
                sum + (parseInt(log.cf_solved) || 0) + (parseInt(log.ac_solved) || 0) + (parseInt(log.cc_solved) || 0), 0);
            document.getElementById('total-solved').textContent = contestSolved + dailySolved;
            
            // Total mistakes
            document.getElementById('total-mistakes').textContent = mistakes.length;
            
            // Total topics
            document.getElementById('total-topics').textContent = topics.length;
            
            // Update active tasks
            updateActiveTasks();
        }

        // Modal setups
        function setupModals() {
            // Contest modal
            document.getElementById('saveContest').addEventListener('click', function() {
                const newContest = {
                    id: contests.length > 0 ? Math.max(...contests.map(c => c.id)) + 1 : 1,
                    date: document.getElementById('contestDate').value,
                    platform: document.getElementById('contestPlatform').value,
                    contest_name: document.getElementById('contestName').value,
                    solved: parseInt(document.getElementById('contestSolved').value) || 0,
                    rating_change: parseInt(document.getElementById('contestRating').value) || 0,
                    rank: parseInt(document.getElementById('contestRank').value) || 0,
                    upsolved: document.getElementById('contestUpsolved').value || '',
                    notes: document.getElementById('contestNotes').value || ''
                };
                
                contests.push(newContest);
                saveData('contests', contests);
                
                // Reset form and close modal
                document.getElementById('contestForm').reset();
                bootstrap.Modal.getInstance(document.getElementById('addContestModal')).hide();
            });
            
            // Daily log modal
            document.getElementById('saveDaily').addEventListener('click', function() {
                const newLog = {
                    id: dailyLogs.length > 0 ? Math.max(...dailyLogs.map(l => l.id)) + 1 : 1,
                    date: document.getElementById('dailyDate').value,
                    cf_solved: parseInt(document.getElementById('cfProblems').value) || 0,
                    ac_solved: parseInt(document.getElementById('atcoderProblems').value) || 0,
                    cc_solved: parseInt(document.getElementById('ccProblems').value) || 0,
                    hours: parseFloat(document.getElementById('dailyHours').value) || 0,
                    contest: document.getElementById('dailyContest').value || '',
                    notes: document.getElementById('dailyNotes').value || ''
                };
                
                dailyLogs.push(newLog);
                saveData('dailyLogs', dailyLogs);
                
                // Reset form and close modal
                document.getElementById('dailyForm').reset();
                bootstrap.Modal.getInstance(document.getElementById('addDailyModal')).hide();
            });
            
            // Mistake modal
            document.getElementById('saveMistake').addEventListener('click', function() {
                const newMistake = {
                    id: mistakes.length > 0 ? Math.max(...mistakes.map(m => m.id)) + 1 : 1,
                    date: document.getElementById('mistakeDate').value,
                    platform: document.getElementById('mistakePlatform').value,
                    problem: document.getElementById('mistakeProblem').value,
                    mistake_type: document.getElementById('mistakeType').value,
                    reason: document.getElementById('mistakeReason').value,
                    fix_strategy: document.getElementById('mistakeFix').value
                };
                
                mistakes.push(newMistake);
                saveData('mistakes', mistakes);
                
                // Reset form and close modal
                document.getElementById('mistakeForm').reset();
                bootstrap.Modal.getInstance(document.getElementById('addMistakeModal')).hide();
            });
            
            // Topic modal
            document.getElementById('saveTopic').addEventListener('click', function() {
                const newTopic = {
                    id: topics.length > 0 ? Math.max(...topics.map(t => t.id)) + 1 : 1,
                    topic: document.getElementById('topicName').value,
                    solved: parseInt(document.getElementById('topicSolved').value) || 0,
                    confidence: parseInt(document.getElementById('topicConfidence').value) || 3,
                    last_practiced: document.getElementById('topicLastPracticed').value,
                    notes: document.getElementById('topicNotes').value || ''
                };
                
                topics.push(newTopic);
                saveData('topics', topics);
                
                // Reset form and close modal
                document.getElementById('topicForm').reset();
                bootstrap.Modal.getInstance(document.getElementById('addTopicModal')).hide();
            });
        }

        // Edit functionality
        function setupEditFunctionality() {
            // Edit cell click
            document.addEventListener('click', function(e) {
                const editable = e.target.closest('.editable');
                if (!editable) return;
                
                const cell = editable;
                const row = cell.closest('tr');
                const id = parseInt(row.getAttribute('data-id'));
                const field = cell.getAttribute('data-field');
                const currentValue = cell.textContent.trim();
                
                // Get type from the tbody id instead of table id
                const tbody = row.closest('tbody');
                const tableId = tbody ? tbody.id : '';
                const type = tableId.split('-')[0]; // e.g., 'contest-table' -> 'contest'
                
                // Set modal title based on type
                let title = '';
                if (type === 'contest') title = 'Contest';
                else if (type === 'daily') title = 'Daily Log';
                else if (type === 'mistake') title = 'Mistake';
                else if (type === 'topic') title = 'Topic';
                
                document.getElementById('editModalLabel').textContent = `Edit ${title}`;
                document.getElementById('editId').value = id;
                document.getElementById('editType').value = type;
                document.getElementById('editField').value = field;
                
                // Create form field based on the cell being edited
                const editFields = document.getElementById('editFields');
                editFields.innerHTML = '';
                
                let inputHtml = '';
                let label = field.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                
                if (field === 'date' || field === 'last_practiced') {
                    inputHtml = `
                        <div class="form-group">
                            <label for="editValue">${label}</label>
                            <input type="date" class="form-control" id="editValue" value="${currentValue}">
                        </div>
                    `;
                } else if (field === 'confidence') {
                    inputHtml = `
                        <div class="form-group">
                            <label for="editValue">${label}</label>
                            <select class="form-control" id="editValue">
                                <option value="1" ${currentValue === '1' ? 'selected' : ''}>1 - Very Low</option>
                                <option value="2" ${currentValue === '2' ? 'selected' : ''}>2 - Low</option>
                                <option value="3" ${currentValue === '3' ? 'selected' : ''}>3 - Moderate</option>
                                <option value="4" ${currentValue === '4' ? 'selected' : ''}>4 - High</option>
                                <option value="5" ${currentValue === '5' ? 'selected' : ''}>5 - Very High</option>
                            </select>
                        </div>
                    `;
                } else if (field === 'contest' || field === 'upsolved') {
                    inputHtml = `
                        <div class="form-group">
                            <label for="editValue">${label}</label>
                            <select class="form-control" id="editValue">
                                <option value="">Select</option>
                                <option value="Yes" ${currentValue === 'Yes' ? 'selected' : ''}>Yes</option>
                                <option value="No" ${currentValue === 'No' ? 'selected' : ''}>No</option>
                            </select>
                        </div>
                    `;
                } else if (field === 'platform') {
                    inputHtml = `
                        <div class="form-group">
                            <label for="editValue">${label}</label>
                            <select class="form-control" id="editValue">
                                <option value="">Select Platform</option>
                                <option value="CF" ${currentValue === 'CF' ? 'selected' : ''}>Codeforces (CF)</option>
                                <option value="AC" ${currentValue === 'AC' ? 'selected' : ''}>AtCoder (AC)</option>
                                <option value="LC" ${currentValue === 'LC' ? 'selected' : ''}>LeetCode (LC)</option>
                                <option value="CC" ${currentValue === 'CC' ? 'selected' : ''}>CodeChef (CC)</option>
                                <option value="Other" ${currentValue === 'Other' ? 'selected' : ''}>Other</option>
                            </select>
                        </div>
                    `;
                } else if (field === 'mistake_type') {
                    inputHtml = `
                        <div class="form-group">
                            <label for="editValue">${label}</label>
                            <select class="form-control" id="editValue">
                                <option value="">Select Type</option>
                                <option value="WA" ${currentValue === 'WA' ? 'selected' : ''}>Wrong Answer (WA)</option>
                                <option value="TLE" ${currentValue === 'TLE' ? 'selected' : ''}>Time Limit Exceeded (TLE)</option>
                                <option value="MLE" ${currentValue === 'MLE' ? 'selected' : ''}>Memory Limit Exceeded (MLE)</option>
                                <option value="RE" ${currentValue === 'RE' ? 'selected' : ''}>Runtime Error (RE)</option>
                                <option value="CE" ${currentValue === 'CE' ? 'selected' : ''}>Compilation Error (CE)</option>
                                <option value="Other" ${currentValue === 'Other' ? 'selected' : ''}>Other</option>
                            </select>
                        </div>
                    `;
                } else if (field === 'notes' || field === 'fix_strategy') {
                    inputHtml = `
                        <div class="form-group">
                            <label for="editValue">${label}</label>
                            <textarea class="form-control" id="editValue" rows="3">${currentValue}</textarea>
                        </div>
                    `;
                } else {
                    inputHtml = `
                        <div class="form-group">
                            <label for="editValue">${label}</label>
                            <input type="${['solved', 'rating_change', 'rank', 'hours', 'cf_solved', 'ac_solved', 'cc_solved'].includes(field) ? 'number' : 'text'}" 
                                   class="form-control" id="editValue" value="${currentValue}">
                        </div>
                    `;
                }
                
                editFields.innerHTML = inputHtml;
                
                // Show modal
                const editModal = new bootstrap.Modal(document.getElementById('editModal'));
                editModal.show();
                
                // Re-attach save handler after modal is shown (only once)
                const modalElement = editModal._element;
                if (!modalElement.hasAttribute('data-save-handler-attached')) {
                    modalElement.addEventListener('shown.bs.modal', function() {
                        // Small delay to ensure DOM is ready
                        setTimeout(() => {
                            setupSaveEditHandler();
                        }, 100);
                    });
                    modalElement.setAttribute('data-save-handler-attached', 'true');
                }
            });
        }

        // Set up save edit functionality separately
        function setupSaveEditHandler() {
            // Direct event listener on the save button
            const saveEditBtn = document.getElementById('saveEdit');
            if (saveEditBtn) {
                // Remove any existing listeners first
                const clonedBtn = saveEditBtn.cloneNode(true);
                saveEditBtn.parentNode.replaceChild(clonedBtn, saveEditBtn);
                
                // Add the listener to the cloned button
                const newSaveBtn = document.getElementById('saveEdit');
                newSaveBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    handleSaveEdit();
                });
            }
        }

        // Handle save edit functionality
        function handleSaveEdit() {
            console.log('handleSaveEdit called'); // Debug log
            
            const id = parseInt(document.getElementById('editId').value);
            const type = document.getElementById('editType').value;
            const field = document.getElementById('editField').value;
            const newValue = document.getElementById('editValue').value;
            
            console.log('Edit data:', { id, type, field, newValue }); // Debug log
            console.log('Current data arrays:', { contests: contests.length, dailyLogs: dailyLogs.length, mistakes: mistakes.length, topics: topics.length }); // Debug log
            
            let itemFound = false;
            
            if (type === 'contest') {
                const contest = contests.find(c => c.id === id);
                console.log('Found contest:', contest); // Debug log
                if (contest) {
                    itemFound = true;
                    // Convert numeric fields to proper types
                    if (['solved', 'rating_change', 'rank'].includes(field)) {
                        contest[field] = parseInt(newValue) || 0;
                    } else {
                        contest[field] = newValue;
                    }
                    console.log('Updated contest:', contest); // Debug log
                    saveData('contests', contests);
                    // Re-render after saving
                    setTimeout(() => {
                        renderContests();
                    }, 500);
                }
            } else if (type === 'daily') {
                const log = dailyLogs.find(l => l.id === id);
                console.log('Found daily log:', log); // Debug log
                if (log) {
                    itemFound = true;
                    // Convert numeric fields to proper types
                    if (['cf_solved', 'ac_solved', 'cc_solved'].includes(field)) {
                        log[field] = parseInt(newValue) || 0;
                    } else if (field === 'hours') {
                        log[field] = parseFloat(newValue) || 0;
                    } else {
                        log[field] = newValue;
                    }
                    console.log('Updated daily log:', log); // Debug log
                    saveData('dailyLogs', dailyLogs);
                    // Re-render after saving
                    setTimeout(() => {
                        renderDailyLogs();
                    }, 500);
                }
            } else if (type === 'mistake') {
                const mistake = mistakes.find(m => m.id === id);
                console.log('Found mistake:', mistake); // Debug log
                if (mistake) {
                    itemFound = true;
                    mistake[field] = newValue;
                    console.log('Updated mistake:', mistake); // Debug log
                    saveData('mistakes', mistakes);
                    // Re-render after saving
                    setTimeout(() => {
                        renderMistakes();
                    }, 500);
                }
            } else if (type === 'topic') {
                const topic = topics.find(t => t.id === id);
                console.log('Found topic:', topic); // Debug log
                if (topic) {
                    itemFound = true;
                    // Convert numeric fields to proper types
                    if (['solved', 'confidence'].includes(field)) {
                        topic[field] = parseInt(newValue) || 0;
                    } else {
                        topic[field] = newValue;
                    }
                    console.log('Updated topic:', topic); // Debug log
                    saveData('topics', topics);
                    // Re-render after saving
                    setTimeout(() => {
                        renderTopics();
                    }, 500);
                }
            }
            
            if (!itemFound) {
                console.error('Item not found!', { id, type, field }); // Debug log
            }
            
            // Close the modal
            const editModal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
            if (editModal) {
                console.log('Closing modal'); // Debug log
                editModal.hide();
            } else {
                console.error('Edit modal instance not found'); // Debug log
            }
        }

        // Delete functionality
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('delete-contest') || e.target.closest('.delete-contest')) {
                const row = e.target.closest('tr');
                const id = parseInt(row.getAttribute('data-id'));
                contests = contests.filter(contest => contest.id !== id);
                saveData('contests', contests);
            }
            
            if (e.target.classList.contains('delete-daily') || e.target.closest('.delete-daily')) {
                const row = e.target.closest('tr');
                const id = parseInt(row.getAttribute('data-id'));
                dailyLogs = dailyLogs.filter(log => log.id !== id);
                saveData('dailyLogs', dailyLogs);
            }
            
            if (e.target.classList.contains('delete-mistake') || e.target.closest('.delete-mistake')) {
                const row = e.target.closest('tr');
                const id = parseInt(row.getAttribute('data-id'));
                mistakes = mistakes.filter(mistake => mistake.id !== id);
                saveData('mistakes', mistakes);
            }
            
            if (e.target.classList.contains('delete-topic') || e.target.closest('.delete-topic')) {
                const row = e.target.closest('tr');
                const id = parseInt(row.getAttribute('data-id'));
                topics = topics.filter(topic => topic.id !== id);
                saveData('topics', topics);
            }
        });

        // Set default dates in forms
        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('contestDate').value = today;
            document.getElementById('dailyDate').value = today;
            document.getElementById('mistakeDate').value = today;
            document.getElementById('topicLastPracticed').value = today;
            document.getElementById('taskDueDate').value = today;
        }

        // Auto-fetch functionality for competitive programming platforms
        let userSettings = {
            cfUsernames: '',
            atcoderUsernames: '',
            codechefUsernames: ''
        };

        // Load user settings from Firebase
        function loadUserSettings() {
            if (!currentUser) return;
            
            const userId = currentUser.uid;
            database.ref(`users/${userId}/settings`).once('value', snapshot => {
                const settings = snapshot.val();
                if (settings) {
                    userSettings = settings;
                    document.getElementById('cfUsernames').value = userSettings.cfUsernames || '';
                    document.getElementById('atcoderUsernames').value = userSettings.atcoderUsernames || '';
                    document.getElementById('codechefUsernames').value = userSettings.codechefUsernames || '';
                }
            });
        }

        // Save user settings to Firebase
        function saveUserSettings() {
            if (!currentUser) return;
            
            const userId = currentUser.uid;
            userSettings.cfUsernames = document.getElementById('cfUsernames').value.trim();
            userSettings.atcoderUsernames = document.getElementById('atcoderUsernames').value.trim();
            userSettings.codechefUsernames = document.getElementById('codechefUsernames').value.trim();
            
            database.ref(`users/${userId}/settings`).set(userSettings);
        }

        // Parse usernames from comma-separated string
        function parseUsernames(usernamesString) {
            if (!usernamesString || typeof usernamesString !== 'string') {
                return [];
            }
            return usernamesString.split(',')
                .map(u => u.trim())
                .filter(u => u.length > 0)
                .filter(u => /^[a-zA-Z0-9_.-]+$/.test(u)); // Basic username validation
        }

        // Fetch Codeforces submissions for multiple usernames
        async function fetchCodeforcesData(usernamesString, date) {
            const usernames = parseUsernames(usernamesString);
            if (usernames.length === 0) {
                return 0;
            }

            try {
                let totalSolved = 0;
                
                for (const username of usernames) {
                    try {
                        const response = await fetch(`https://codeforces.com/api/user.status?handle=${username}`, {
                            headers: {
                                'Accept': 'application/json',
                            }
                        });
                        
                        if (!response.ok) {
                            console.warn(`Failed to fetch data for CF user: ${username} (HTTP ${response.status})`);
                            continue;
                        }
                        
                        const data = await response.json();

                        if (data.status !== 'OK') {
                            console.warn(`Codeforces API error for user ${username}: ${data.comment}`);
                            continue;
                        }

                        // Convert date to timestamp range
                        const targetDate = new Date(date);
                        const startOfDay = new Date(targetDate.setHours(0, 0, 0, 0)).getTime() / 1000;
                        const endOfDay = new Date(targetDate.setHours(23, 59, 59, 999)).getTime() / 1000;

                        // Filter submissions for the target date and count accepted solutions
                        const acceptedSubmissions = data.result.filter(submission => {
                            return submission.creationTimeSeconds >= startOfDay && 
                                   submission.creationTimeSeconds <= endOfDay && 
                                   submission.verdict === 'OK';
                        });

                        // Count unique problems solved by this user
                        const uniqueProblems = new Set();
                        acceptedSubmissions.forEach(submission => {
                            if (submission.problem) {
                                uniqueProblems.add(`${submission.problem.contestId}-${submission.problem.index}`);
                            }
                        });

                        totalSolved += uniqueProblems.size;
                        console.log(`CF user ${username}: ${uniqueProblems.size} problems solved on ${date}`);
                        
                    } catch (userError) {
                        console.warn(`Error fetching data for CF user ${username}:`, userError);
                        continue;
                    }
                }

                return totalSolved;
            } catch (error) {
                console.error('Error fetching Codeforces data:', error);
                throw new Error(`Codeforces API error: ${error.message}`);
            }
        }

        // Fetch AtCoder submissions for multiple usernames
        async function fetchAtCoderData(usernamesString, date) {
            const usernames = parseUsernames(usernamesString);
            if (usernames.length === 0) {
                return 0;
            }

            try {
                let totalSolved = 0;
                
                for (const username of usernames) {
                    try {
                        const response = await fetch(`https://kenkoooo.com/atcoder/atcoder-api/v3/user/submissions?user=${username}`, {
                            headers: {
                                'Accept': 'application/json',
                            }
                        });
                        
                        if (!response.ok) {
                            console.warn(`Failed to fetch data for AtCoder user: ${username} (HTTP ${response.status})`);
                            continue;
                        }
                        
                        const data = await response.json();

                        // Convert date to timestamp range
                        const targetDate = new Date(date);
                        const startOfDay = new Date(targetDate.setHours(0, 0, 0, 0)).getTime() / 1000;
                        const endOfDay = new Date(targetDate.setHours(23, 59, 59, 999)).getTime() / 1000;

                        // Filter submissions for the target date and count accepted solutions
                        const acceptedSubmissions = data.filter(submission => {
                            return submission.epoch_second >= startOfDay && 
                                   submission.epoch_second <= endOfDay && 
                                   submission.result === 'AC';
                        });

                        // Count unique problems solved by this user
                        const uniqueProblems = new Set();
                        acceptedSubmissions.forEach(submission => {
                            uniqueProblems.add(submission.problem_id);
                        });

                        totalSolved += uniqueProblems.size;
                        console.log(`AtCoder user ${username}: ${uniqueProblems.size} problems solved on ${date}`);
                        
                    } catch (userError) {
                        console.warn(`Error fetching data for AtCoder user ${username}:`, userError);
                        continue;
                    }
                }

                return totalSolved;
            } catch (error) {
                console.error('Error fetching AtCoder data:', error);
                throw new Error(`AtCoder API error: ${error.message}`);
            }
        }

        // Fetch CodeChef submissions for multiple usernames
        async function fetchCodeChefData(usernamesString, date) {
            const usernames = parseUsernames(usernamesString);
            if (usernames.length === 0) {
                return 0; // Return 0 instead of throwing error for optional platform
            }

            try {
                // Note: CodeChef doesn't have a public API for submissions
                // For future implementation, you could use:
                // 1. Web scraping (not recommended due to rate limits)
                // 2. CodeChef's official API when available
                // 3. User manual input (current approach)
                
                console.warn(`CodeChef API integration is not available. Please enter data manually for usernames: ${usernames.join(', ')}`);
                
                // Return 0 - user will need to enter manually
                return 0;
            } catch (error) {
                console.error('Error with CodeChef data fetching:', error);
                return 0; // Graceful degradation
            }
        }

        // Setup auto-fetch event listeners
        function setupAutoFetch() {
            // Auto-fetch button for all three platforms
            document.getElementById('autoFetchBtn').addEventListener('click', async function() {
                const btn = this;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="bi bi-spinner-border spinner-border-sm"></i> Fetching...';
                btn.disabled = true;

                // Clear previous alerts
                const existingAlerts = document.querySelectorAll('#addDailyModal .alert');
                existingAlerts.forEach(alert => alert.remove());

                try {
                    // Save usernames first
                    saveUserSettings();

                    const selectedDate = document.getElementById('dailyDate').value;
                    if (!selectedDate) {
                        throw new Error('Please select a date first');
                    }

                    // Validate date is not in future
                    const today = new Date().toISOString().split('T')[0];
                    if (selectedDate > today) {
                        throw new Error('Cannot fetch data for future dates');
                    }

                    const cfUsernames = document.getElementById('cfUsernames').value.trim();
                    const atcoderUsernames = document.getElementById('atcoderUsernames').value.trim();
                    const codechefUsernames = document.getElementById('codechefUsernames').value.trim();

                    if (!cfUsernames && !atcoderUsernames && !codechefUsernames) {
                        throw new Error('Please enter at least one username for any platform');
                    }

                    // Fetch from all platforms with individual error handling
                    let cfSolved = 0, acSolved = 0, ccSolved = 0;
                    let fetchResults = [];
                    
                    if (cfUsernames) {
                        try {
                            cfSolved = await fetchCodeforcesData(cfUsernames, selectedDate);
                            fetchResults.push(`✅ Codeforces: ${cfSolved} problems`);
                        } catch (error) {
                            fetchResults.push(`❌ Codeforces: ${error.message}`);
                            console.error('CF fetch error:', error);
                        }
                    }
                    
                    if (atcoderUsernames) {
                        try {
                            acSolved = await fetchAtCoderData(atcoderUsernames, selectedDate);
                            fetchResults.push(`✅ AtCoder: ${acSolved} problems`);
                        } catch (error) {
                            fetchResults.push(`❌ AtCoder: ${error.message}`);
                            console.error('AtCoder fetch error:', error);
                        }
                    }

                    if (codechefUsernames) {
                        ccSolved = await fetchCodeChefData(codechefUsernames, selectedDate);
                        fetchResults.push(`ℹ️ CodeChef: Manual entry required`);
                    }

                    // Update the input fields
                    document.getElementById('cfProblems').value = cfSolved;
                    document.getElementById('atcoderProblems').value = acSolved;
                    document.getElementById('ccProblems').value = ccSolved;

                    // Show comprehensive success message
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert alert-success alert-dismissible fade show';
                    alertDiv.innerHTML = `
                        <strong>Auto-fetch completed for ${selectedDate}!</strong><br>
                        ${fetchResults.join('<br>')}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                    document.querySelector('#addDailyModal .modal-body').insertBefore(alertDiv, document.querySelector('#addDailyModal .card'));

                    // Show CodeChef notice if needed
                    if (codechefUsernames && ccSolved === 0) {
                        const codeChefNotice = document.createElement('div');
                        codeChefNotice.className = 'alert alert-info alert-dismissible fade show mt-2';
                        codeChefNotice.innerHTML = `
                            <strong>CodeChef Integration:</strong> Currently requires manual data entry. 
                            Consider using the official CodeChef mobile app or website to track your daily progress.
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        `;
                        document.querySelector('#addDailyModal .modal-body').insertBefore(codeChefNotice, document.querySelector('#addDailyModal .card'));
                    }

                } catch (error) {
                    // Show error message
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert alert-danger alert-dismissible fade show';
                    alertDiv.innerHTML = `
                        <strong>Auto-fetch Error:</strong> ${error.message}
                        <br><small>You can still enter data manually below.</small>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                    document.querySelector('#addDailyModal .modal-body').insertBefore(alertDiv, document.querySelector('#addDailyModal .card'));
                } finally {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            });

            // Load saved usernames when modal opens
            document.getElementById('addDailyModal').addEventListener('show.bs.modal', function() {
                loadUserSettings();
                // Clear any existing alerts
                const existingAlerts = document.querySelectorAll('#addDailyModal .alert');
                existingAlerts.forEach(alert => alert.remove());
                // Set today's date as default if no date is set
                const dateInput = document.getElementById('dailyDate');
                if (!dateInput.value) {
                    dateInput.value = new Date().toISOString().split('T')[0];
                }
            });
        }

        // Profile & Settings Setup
        function setupProfileSettings() {
            // Change Password Form
            document.getElementById('changePasswordForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const messageDiv = document.getElementById('passwordChangeMessage');
                
                // Clear previous messages
                messageDiv.innerHTML = '';
                
                // Validate passwords
                if (newPassword !== confirmPassword) {
                    messageDiv.innerHTML = '<div class="alert alert-danger">New passwords do not match!</div>';
                    return;
                }
                
                if (newPassword.length < 6) {
                    messageDiv.innerHTML = '<div class="alert alert-danger">Password must be at least 6 characters!</div>';
                    return;
                }
                
                try {
                    const user = auth.currentUser;
                    const credential = firebase.auth.EmailAuthProvider.credential(user.email, currentPassword);
                    
                    // Re-authenticate user
                    await user.reauthenticateWithCredential(credential);
                    
                    // Update password
                    await user.updatePassword(newPassword);
                    
                    messageDiv.innerHTML = '<div class="alert alert-success">Password changed successfully!</div>';
                    document.getElementById('changePasswordForm').reset();
                    
                } catch (error) {
                    let errorMessage = 'Failed to change password.';
                    if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Current password is incorrect.';
                    } else if (error.code === 'auth/weak-password') {
                        errorMessage = 'New password is too weak.';
                    }
                    messageDiv.innerHTML = `<div class="alert alert-danger">${errorMessage}</div>`;
                }
            });
            
            // Save Settings
            document.getElementById('saveSettings').addEventListener('click', function() {
                const settings = {
                    emailReminders: document.getElementById('emailReminders').checked,
                    contestNotifications: document.getElementById('contestNotifications').checked,
                    defaultView: document.getElementById('defaultView').value
                };
                
                if (currentUser) {
                    const userId = currentUser.uid;
                    database.ref(`users/${userId}/userSettings`).set(settings)
                        .then(() => {
                            alert('Settings saved successfully!');
                        })
                        .catch((error) => {
                            alert('Failed to save settings: ' + error.message);
                        });
                }
            });
            
            // Export Data
            document.getElementById('exportData').addEventListener('click', function() {
                const allData = {
                    contests: contests,
                    dailyLogs: dailyLogs,
                    mistakes: mistakes,
                    topics: topics,
                    tasks: tasks,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const dataStr = JSON.stringify(allData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `cp-tracker-data-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            });
            
            // Import Data
            document.getElementById('importData').addEventListener('click', function() {
                document.getElementById('importFile').click();
            });
            
            document.getElementById('importFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        if (confirm('This will replace all your current data. Are you sure?')) {
                            // Save imported data
                            if (importedData.contests) {
                                contests = importedData.contests;
                                saveData('contests', contests);
                            }
                            if (importedData.dailyLogs) {
                                dailyLogs = importedData.dailyLogs;
                                saveData('dailyLogs', dailyLogs);
                            }
                            if (importedData.mistakes) {
                                mistakes = importedData.mistakes;
                                saveData('mistakes', mistakes);
                            }
                            if (importedData.topics) {
                                topics = importedData.topics;
                                saveData('topics', topics);
                            }
                            if (importedData.tasks) {
                                tasks = importedData.tasks;
                                saveData('tasks', tasks);
                            }
                            
                            alert('Data imported successfully!');
                            // Refresh all displays
                            location.reload();
                        }
                    } catch (error) {
                        alert('Invalid file format!');
                    }
                };
                reader.readAsText(file);
            });
            
            // Delete Account Confirmation
            document.getElementById('deleteConfirmation').addEventListener('input', function() {
                const confirmButton = document.getElementById('confirmDeleteAccount');
                confirmButton.disabled = this.value !== 'DELETE';
            });
            
            document.getElementById('confirmDeleteAccount').addEventListener('click', async function() {
                try {
                    const user = auth.currentUser;
                    const userId = user.uid;
                    
                    // Delete all user data from Firebase
                    await database.ref(`users/${userId}`).remove();
                    
                    // Delete the user account
                    await user.delete();
                    
                    alert('Account deleted successfully. You will be logged out.');
                    
                } catch (error) {
                    if (error.code === 'auth/requires-recent-login') {
                        alert('Please log out and log back in, then try again.');
                    } else {
                        alert('Failed to delete account: ' + error.message);
                    }
                }
            });
        }
        
        // Update Profile Information
        function updateProfileInfo() {
            if (!currentUser) return;
            
            // Display user email
            document.getElementById('userEmail').textContent = currentUser.email;
            
            // Display account creation date
            const creationTime = currentUser.metadata.creationTime;
            if (creationTime) {
                const createdDate = new Date(creationTime).toLocaleDateString();
                document.getElementById('userCreated').textContent = createdDate;
            }
            
            // Calculate and display totals
            const totalProblems = dailyLogs.reduce((sum, log) => 
                sum + (parseInt(log.cf_solved) || 0) + (parseInt(log.ac_solved) || 0) + (parseInt(log.cc_solved) || 0), 0) +
                contests.reduce((sum, contest) => sum + (parseInt(contest.solved) || 0), 0);
            
            document.getElementById('profileTotalProblems').textContent = totalProblems;
            document.getElementById('profileTotalContests').textContent = contests.length;
            document.getElementById('profileTotalTopics').textContent = topics.length;
            
            // Load user settings
            const userId = currentUser.uid;
            database.ref(`users/${userId}/userSettings`).once('value', snapshot => {
                const settings = snapshot.val();
                if (settings) {
                    document.getElementById('emailReminders').checked = settings.emailReminders !== false;
                    document.getElementById('contestNotifications').checked = settings.contestNotifications !== false;
                    document.getElementById('defaultView').value = settings.defaultView || 'dashboard';
                }
            });
        }

        // Advanced Analytics Functions
        function updateAdvancedAnalytics() {
            updateAdvancedMetrics();
            updateContestRatingChart();
            updateSolvingVelocityChart();
            updatePlatformChart();
            updateTopicMasteryChart();
            updateMistakeDistributionChart();
            updateActivityHeatmap();
            updateStudyTimeAnalysis();
            generateSmartInsights();
        }

        function updateAdvancedMetrics() {
            // Average rating change
            const ratingChanges = contests.filter(c => c.rating_change && !isNaN(parseInt(c.rating_change)))
                                          .map(c => parseInt(c.rating_change));
            const avgRatingChange = ratingChanges.length > 0 ? 
                Math.round(ratingChanges.reduce((a, b) => a + b, 0) / ratingChanges.length) : 0;
            document.getElementById('avg-rating-change').textContent = avgRatingChange >= 0 ? `+${avgRatingChange}` : avgRatingChange;

            // Problems per day
            const totalProblems = dailyLogs.reduce((sum, log) => sum + (parseInt(log.cf_solved) || 0) + (parseInt(log.ac_solved) || 0) + (parseInt(log.cc_solved) || 0), 0);
            const daysWithData = dailyLogs.length || 1;
            const problemsPerDay = (totalProblems / daysWithData).toFixed(1);
            document.getElementById('problems-per-day').textContent = problemsPerDay;

            // Contest accuracy (problems solved vs attempted)
            const totalSolved = contests.reduce((sum, c) => sum + (parseInt(c.solved) || 0), 0);
            const estimatedAttempted = totalSolved * 1.3; // Estimate based on typical contest performance
            const accuracy = totalSolved > 0 ? Math.round((totalSolved / estimatedAttempted) * 100) : 0;
            document.getElementById('contest-accuracy').textContent = `${accuracy}%`;

            // Study streak
            const streak = calculateStudyStreak();
            document.getElementById('study-streak').textContent = `${streak} days`;

            // Best rank
            const ranks = contests.filter(c => c.rank && !isNaN(parseInt(c.rank))).map(c => parseInt(c.rank));
            const bestRank = ranks.length > 0 ? Math.min(...ranks) : '-';
            document.getElementById('best-rank').textContent = bestRank === '-' ? '-' : `#${bestRank}`;

            // Improvement score
            const improvementScore = calculateImprovementScore();
            document.getElementById('improvement-score').textContent = `${improvementScore}%`;
        }

        function calculateStudyStreak() {
            if (dailyLogs.length === 0) return 0;
            
            const sortedLogs = dailyLogs.sort((a, b) => new Date(b.date) - new Date(a.date));
            let streak = 0;
            let currentDate = new Date();
            
            for (let log of sortedLogs) {
                const logDate = new Date(log.date);
                const daysDiff = Math.floor((currentDate - logDate) / (1000 * 60 * 60 * 24));
                
                if (daysDiff === streak) {
                    streak++;
                } else if (daysDiff > streak) {
                    break;
                }
            }
            
            return streak;
        }

        function calculateImprovementScore() {
            if (contests.length < 2) return 0;
            
            const recentContests = contests.slice(-5); // Last 5 contests
            const olderContests = contests.slice(0, Math.max(1, contests.length - 5));
            
            const recentAvg = recentContests.reduce((sum, c) => sum + (parseInt(c.solved) || 0), 0) / recentContests.length;
            const olderAvg = olderContests.reduce((sum, c) => sum + (parseInt(c.solved) || 0), 0) / olderContests.length;
            
            return olderAvg > 0 ? Math.round(((recentAvg - olderAvg) / olderAvg) * 100) : 0;
        }

        function updateContestRatingChart() {
            const ctx = document.getElementById('contestRatingChart').getContext('2d');
            
            const sortedContests = contests.filter(c => c.rating_change && !isNaN(parseInt(c.rating_change)))
                                          .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            let cumulativeRating = 1500; // Starting rating
            const data = sortedContests.map(contest => {
                cumulativeRating += parseInt(contest.rating_change);
                return {
                    x: contest.date,
                    y: cumulativeRating
                };
            });

            new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Rating Progress',
                        data: data,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                parser: 'YYYY-MM-DD',
                                displayFormats: {
                                    day: 'MMM DD'
                                }
                            }
                        },
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Rating'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true
                        }
                    }
                }
            });
        }

        function updateSolvingVelocityChart() {
            const ctx = document.getElementById('solvingVelocityChart').getContext('2d');
            
            const last30Days = [...Array(30)].map((_, i) => {
                const date = new Date();
                date.setDate(date.getDate() - i);
                return date.toISOString().split('T')[0];
            }).reverse();

            const velocityData = last30Days.map(date => {
                const log = dailyLogs.find(l => l.date === date);
                return log ? (parseInt(log.cf_solved) || 0) + (parseInt(log.ac_solved) || 0) + (parseInt(log.cc_solved) || 0) : 0;
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: last30Days.map(date => new Date(date).getDate()),
                    datasets: [{
                        label: 'Problems Solved',
                        data: velocityData,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Problems'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Day of Month'
                            }
                        }
                    }
                }
            });
        }

        function updatePlatformChart() {
            const ctx = document.getElementById('platformChart').getContext('2d');
            
            // Count contest platforms
            const contestPlatformCounts = {};
            contests.forEach(contest => {
                contestPlatformCounts[contest.platform] = (contestPlatformCounts[contest.platform] || 0) + 1;
            });

            // Count daily solving by platform
            const dailyPlatformCounts = {
                'CF': 0,
                'AC': 0, 
                'CC': 0
            };
            
            dailyLogs.forEach(log => {
                dailyPlatformCounts['CF'] += parseInt(log.cf_solved) || 0;
                dailyPlatformCounts['AC'] += parseInt(log.ac_solved) || 0;
                dailyPlatformCounts['CC'] += parseInt(log.cc_solved) || 0;
            });

            // Combine data (prefer daily solving data if available)
            const platformData = { ...contestPlatformCounts };
            Object.keys(dailyPlatformCounts).forEach(platform => {
                if (dailyPlatformCounts[platform] > 0) {
                    platformData[platform] = (platformData[platform] || 0) + dailyPlatformCounts[platform];
                }
            });

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(platformData),
                    datasets: [{
                        label: 'Problems Solved',
                        data: Object.values(platformData),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + ' problems';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateTopicMasteryChart() {
            const ctx = document.getElementById('topicMasteryChart').getContext('2d');
            
            if (topics.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No topic data available', ctx.canvas.width/2, ctx.canvas.height/2);
                return;
            }

            const topicNames = topics.slice(0, 6).map(t => t.topic); // Top 6 topics
            const confidenceScores = topics.slice(0, 6).map(t => parseInt(t.confidence) || 0);

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: topicNames,
                    datasets: [{
                        label: 'Mastery Level',
                        data: confidenceScores,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        pointBackgroundColor: 'rgba(255, 99, 132, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(255, 99, 132, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            angleLines: {
                                display: false
                            },
                            suggestedMin: 0,
                            suggestedMax: 5
                        }
                    }
                }
            });
        }

        function updateMistakeDistributionChart() {
            const ctx = document.getElementById('mistakeDistributionChart').getContext('2d');
            
            const mistakeTypes = ['WA', 'TLE', 'MLE', 'RE', 'CE', 'Other'];
            const mistakeCounts = mistakeTypes.map(type => 
                mistakes.filter(m => m.mistake_type === type).length
            );

            new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: mistakeTypes,
                    datasets: [{
                        data: mistakeCounts,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(255, 159, 64, 0.7)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateActivityHeatmap() {
            const heatmapContainer = document.getElementById('activityHeatmap');
            const period = document.getElementById('heatmapPeriod').value;
            
            let days;
            switch(period) {
                case '3months': days = 90; break;
                case '6months': days = 180; break;
                case '1year': days = 365; break;
                default: days = 90;
            }

            const today = new Date();
            const heatmapData = [];
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const log = dailyLogs.find(l => l.date === dateStr);
                const activity = log ? (parseInt(log.cf_solved) || 0) + (parseInt(log.ac_solved) || 0) + (parseInt(log.cc_solved) || 0) : 0;
                
                let level = 0;
                if (activity > 0) level = 1;
                if (activity >= 3) level = 2;
                if (activity >= 5) level = 3;
                if (activity >= 8) level = 4;
                
                heatmapData.push({ date: dateStr, level, activity });
            }

            // Create heatmap visualization
            let heatmapHTML = '<div style="display: flex; flex-wrap: wrap; gap: 2px;">';
            heatmapData.forEach(day => {
                heatmapHTML += `<div class="heatmap-day level-${day.level}" 
                                     title="${day.date}: ${day.activity} problems"></div>`;
            });
            heatmapHTML += '</div>';
            
            heatmapContainer.innerHTML = heatmapHTML;
        }

        function updateStudyTimeAnalysis() {
            const totalHours = dailyLogs.reduce((sum, log) => sum + (parseFloat(log.hours) || 0), 0);
            const avgDailyHours = dailyLogs.length > 0 ? (totalHours / dailyLogs.length).toFixed(1) : 0;
            
            document.getElementById('total-study-hours').textContent = `${totalHours.toFixed(1)}h`;
            document.getElementById('avg-daily-hours').textContent = `${avgDailyHours}h`;
            
            // Find peak study day
            const dayHours = {};
            dailyLogs.forEach(log => {
                const dayOfWeek = new Date(log.date).getDay();
                const dayName = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][dayOfWeek];
                dayHours[dayName] = (dayHours[dayName] || 0) + (parseFloat(log.hours) || 0);
            });
            
            const peakDay = Object.keys(dayHours).reduce((a, b) => dayHours[a] > dayHours[b] ? a : b, '-');
            document.getElementById('peak-study-day').textContent = peakDay;

            // Study time chart
            const ctx = document.getElementById('studyTimeChart').getContext('2d');
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const dayData = dayNames.map(day => dayHours[day] || 0);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dayNames,
                    datasets: [{
                        label: 'Hours',
                        data: dayData,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function generateSmartInsights() {
            const insights = [];
            const suggestions = [];
            
            // Performance insights
            if (contests.length >= 3) {
                const recentSolved = contests.slice(-3).reduce((sum, c) => sum + (parseInt(c.solved) || 0), 0) / 3;
                const overallAvg = contests.reduce((sum, c) => sum + (parseInt(c.solved) || 0), 0) / contests.length;
                
                if (recentSolved > overallAvg) {
                    insights.push("📈 Your recent contest performance is improving!");
                } else if (recentSolved < overallAvg * 0.8) {
                    insights.push("📉 Your recent contest performance has declined. Consider reviewing fundamentals.");
                }
            }
            
            if (dailyLogs.length > 7) {
                const recentWeekProblems = dailyLogs.slice(-7).reduce((sum, log) => 
                    sum + (parseInt(log.cf_solved) || 0) + (parseInt(log.ac_solved) || 0) + (parseInt(log.cc_solved) || 0), 0);
                
                if (recentWeekProblems >= 20) {
                    insights.push("🔥 Excellent problem-solving volume this week!");
                } else if (recentWeekProblems < 10) {
                    insights.push("⚠️ Low problem-solving activity this week.");
                }
            }
            
            // Improvement suggestions
            const lowConfidenceTopics = topics.filter(t => parseInt(t.confidence) <= 2);
            if (lowConfidenceTopics.length > 0) {
                suggestions.push(`💡 Focus on improving: ${lowConfidenceTopics.slice(0, 2).map(t => t.topic).join(', ')}`);
            }
            
            const commonMistakes = mistakes.reduce((acc, m) => {
                acc[m.mistake_type] = (acc[m.mistake_type] || 0) + 1;
                return acc;
            }, {});
            
            const mostCommonMistake = Object.keys(commonMistakes).reduce((a, b) => 
                commonMistakes[a] > commonMistakes[b] ? a : b, '');
            
            if (mostCommonMistake && commonMistakes[mostCommonMistake] >= 3) {
                suggestions.push(`🎯 Work on reducing ${mostCommonMistake} errors - your most common mistake type.`);
            }
            
            if (dailyLogs.length > 0) {
                const avgHours = dailyLogs.reduce((sum, log) => sum + (parseFloat(log.hours) || 0), 0) / dailyLogs.length;
                if (avgHours < 2) {
                    suggestions.push("⏰ Consider increasing daily practice time to 2+ hours for faster improvement.");
                }
            }
            
            // Display insights
            const insightsContainer = document.getElementById('performance-insights');
            insightsContainer.innerHTML = insights.length > 0 ? 
                insights.map(insight => `<div class="insight-item">${insight}</div>`).join('') :
                '<div class="insight-item">Keep logging data to see personalized insights!</div>';
            
            const suggestionsContainer = document.getElementById('improvement-suggestions');
            suggestionsContainer.innerHTML = suggestions.length > 0 ? 
                suggestions.map(suggestion => `<div class="suggestion-item">${suggestion}</div>`).join('') :
                '<div class="suggestion-item">Great job! Keep up the consistent practice.</div>';
        }

        // New Enhanced Features
        
        // Toast Notification System
        function showToast(message, type = 'info') {
            const toastEl = document.getElementById('notification-toast');
            const messageEl = document.getElementById('toast-message');
            
            messageEl.textContent = message;
            
            // Set toast color based on type
            toastEl.className = 'toast custom-toast show';
            if (type === 'success') {
                toastEl.style.borderLeft = '4px solid var(--success-color)';
            } else if (type === 'error') {
                toastEl.style.borderLeft = '4px solid var(--danger-color)';
            } else if (type === 'warning') {
                toastEl.style.borderLeft = '4px solid var(--warning-color)';
            } else {
                toastEl.style.borderLeft = '4px solid var(--primary-color)';
            }
            
            const toast = new bootstrap.Toast(toastEl);
            toast.show();
        }

        // Calculate and update streak
        function updateStreak() {
            if (dailyLogs.length === 0) {
                document.getElementById('streak-days').textContent = '0 days';
                return;
            }

            const sortedLogs = [...dailyLogs].sort((a, b) => new Date(b.date) - new Date(a.date));
            let streak = 0;
            let currentDate = new Date();
            currentDate.setHours(0, 0, 0, 0);

            for (let i = 0; i < sortedLogs.length; i++) {
                const logDate = new Date(sortedLogs[i].date);
                logDate.setHours(0, 0, 0, 0);
                
                const diffTime = currentDate - logDate;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === streak) {
                    const problemsSolved = (parseInt(sortedLogs[i].cf_solved) || 0) + 
                                         (parseInt(sortedLogs[i].ac_solved) || 0) + 
                                         (parseInt(sortedLogs[i].cc_solved) || 0);
                    if (problemsSolved > 0) {
                        streak++;
                        currentDate.setDate(currentDate.getDate() - 1);
                    } else {
                        break;
                    }
                } else if (diffDays > streak) {
                    break;
                }
            }

            document.getElementById('streak-days').textContent = `${streak} days`;
            
            // Show achievement notification for milestone streaks
            if (streak > 0 && streak % 7 === 0) {
                showToast(`🔥 Amazing! You've maintained a ${streak}-day streak!`, 'success');
            }
        }

        // Quick add problem function
        function quickAddProblem() {
            const today = new Date().toISOString().split('T')[0];
            
            // Check if today's log exists
            let todayLog = dailyLogs.find(log => log.date === today);
            
            if (!todayLog) {
                // Create new log for today
                todayLog = {
                    id: dailyLogs.length > 0 ? Math.max(...dailyLogs.map(l => l.id)) + 1 : 1,
                    date: today,
                    cf_solved: 1,
                    ac_solved: 0,
                    cc_solved: 0,
                    hours: 1,
                    contest: '',
                    notes: 'Quick add via dashboard'
                };
                dailyLogs.push(todayLog);
            } else {
                // Increment CF problems by 1
                todayLog.cf_solved = (parseInt(todayLog.cf_solved) || 0) + 1;
            }
            
            saveData('dailyLogs', dailyLogs);
            showToast('Problem added to today\'s log!', 'success');
            updateDashboardStats();
            updateStreak();
        }

        // Open auto-fetch modal
        function openAutoFetch() {
            // Simulate opening the auto-fetch modal (you can customize this)
            const modal = new bootstrap.Modal(document.getElementById('autoFetchModal'));
            modal.show();
        }

        // Mobile sidebar toggle
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('show');
        }

        // Quick stats functions
        function updateQuickStats() {
            const today = new Date().toISOString().split('T')[0];
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

            // Today's problems
            const todayLog = dailyLogs.find(log => log.date === today);
            const todayProblems = todayLog ? 
                (parseInt(todayLog.cf_solved) || 0) + (parseInt(todayLog.ac_solved) || 0) + (parseInt(todayLog.cc_solved) || 0) : 0;
            document.getElementById('today-problems').textContent = todayProblems;

            // Week's problems
            const weekLogs = dailyLogs.filter(log => log.date >= weekAgo);
            const weekProblems = weekLogs.reduce((sum, log) => 
                sum + (parseInt(log.cf_solved) || 0) + (parseInt(log.ac_solved) || 0) + (parseInt(log.cc_solved) || 0), 0);
            document.getElementById('week-problems').textContent = weekProblems;

            // Average rating (from contests)
            const ratingsWithChange = contests.filter(c => c.rating_change && c.rating_change !== 0);
            if (ratingsWithChange.length > 0) {
                const avgRating = Math.round(ratingsWithChange.reduce((sum, c) => sum + (parseInt(c.rating_change) || 0), 0) / ratingsWithChange.length);
                document.getElementById('avg-rating').textContent = avgRating > 0 ? `+${avgRating}` : avgRating;
            } else {
                document.getElementById('avg-rating').textContent = '-';
            }

            // Success rate (contests with positive rating change)
            if (contests.length > 0) {
                const successfulContests = contests.filter(c => (parseInt(c.rating_change) || 0) > 0).length;
                const successRate = Math.round((successfulContests / contests.length) * 100);
                document.getElementById('success-rate').textContent = `${successRate}%`;
            } else {
                document.getElementById('success-rate').textContent = '-';
            }
        }

        // Show quick stats with animation
        function showQuickStats() {
            updateQuickStats();
            const quickStats = document.querySelector('.quick-stats');
            quickStats.style.animation = 'pulse 0.6s ease-in-out';
            setTimeout(() => {
                quickStats.style.animation = '';
            }, 600);
            showToast('Stats refreshed!', 'info');
        }

        // Refresh dashboard
        function refreshDashboard() {
            showLoadingOverlay(true);
            
            setTimeout(() => {
                updateDashboardStats();
                updateQuickStats();
                updateStreak();
                updateActiveTasks();
                showLoadingOverlay(false);
                showToast('Dashboard refreshed!', 'success');
            }, 1000);
        }

        // Show/hide loading overlay
        function showLoadingOverlay(show) {
            const overlay = document.getElementById('loading-overlay');
            overlay.style.display = show ? 'flex' : 'none';
        }

        // Quick actions floating button
        function showQuickActions() {
            const actions = [
                { text: 'Add Problem', action: quickAddProblem, icon: 'bi-plus-circle' },
                { text: 'Sync Data', action: openAutoFetch, icon: 'bi-cloud-download' },
                { text: 'View Analytics', action: () => showSection('analytics'), icon: 'bi-graph-up' }
            ];
            
            // Create quick action menu (you can enhance this further)
            showToast('Quick actions: Add Problem, Sync Data, View Analytics', 'info');
        }

        // Enhanced update dashboard stats
        function updateDashboardStatsEnhanced() {
            updateDashboardStats();
            updateQuickStats();
            updateStreak();
        }

        // Add event listener for heatmap period change
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('heatmapPeriod').addEventListener('change', updateActivityHeatmap);
            
            // Initialize enhanced features
            setTimeout(() => {
                updateStreak();
                updateQuickStats();
            }, 1000);
        });

        // Override the original updateDashboardStats to include new features
        const originalUpdateDashboardStats = updateDashboardStats;
        updateDashboardStats = function() {
            originalUpdateDashboardStats.call(this);
            updateQuickStats();
            updateStreak();
        };
    </script>

    <!-- Toast Notifications Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="notification-toast" class="toast custom-toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">CP Tracker</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-message">
                <!-- Toast message will appear here -->
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab d-none d-lg-block" onclick="showQuickActions()" title="Quick Actions">
        <i class="bi bi-plus"></i>
    </button>

    <!-- Loading Overlay -->
    <div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
        <div class="loading-spinner"></div>
    </div>

</body>
</html>